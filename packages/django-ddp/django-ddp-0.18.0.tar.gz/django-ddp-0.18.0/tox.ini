# Tox (http://tox.testrun.org/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
# require tox>=2.1.1 or refuse to run the tests.
minversion=2.1.1

# return success even if some of the specified environments are missing
skip_missing_interpreters=True

# "envlist" is a comma separated list of environments, each environment name
# contains factors separated by hyphens.  For example, "py27-unittest" has 2
# factors: "py27" and "unittest".  Other settings such as "setenv" accept the
# factor names as a prefixes (eg: "unittest: ...") so that prefixed settings
# only apply if the environment being run contains that factor.

envlist =
    py27-test,
    py33-test,
    py34-test,
    py35-test,
    pypy-test,

[testenv]
recreate=True
usedevelop=True
passenv=
    BUILD_NUMBER
    BUILD_URL
    XDG_CACHE_HOME

# stop running commands if previous commands fail
ignore_errors = False

commands =
    dist: check-manifest
    py{27,33,34,35}-test: coverage run --concurrency=gevent {toxinidir}/dddp/test/manage.py test -v3 --noinput
    pypy-test: coverage run {toxinidir}/dddp/test/manage.py test -v3 --noinput
    test: coverage report
    dist: {envpython} setup.py --quiet --no-user-cfg sdist --dist-dir={toxinidir}/dist/
    dist: {envpython} setup.py --quiet --no-user-cfg bdist_wheel --dist-dir={toxinidir}/dist/

deps =
    test: coverage
    dist: check-manifest
    dist: wheel
