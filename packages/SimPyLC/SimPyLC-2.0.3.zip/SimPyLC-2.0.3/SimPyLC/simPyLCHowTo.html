<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
h1
	{mso-style-link:"Kop 1 Char";
	margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:#365F91;}
h2
	{mso-style-link:"Kop 2 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;}
h3
	{mso-style-link:"Kop 3 Char";
	margin-top:10.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Koptekst Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Voettekst Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
pre
	{mso-style-link:"HTML - vooraf opgemaakt Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Ballontekst Char";
	margin:0cm;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:36.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:36.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Kop1Char
	{mso-style-name:"Kop 1 Char";
	mso-style-link:"Kop 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Kop2Char
	{mso-style-name:"Kop 2 Char";
	mso-style-link:"Kop 2";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.Kop3Char
	{mso-style-name:"Kop 3 Char";
	mso-style-link:"Kop 3";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.KoptekstChar
	{mso-style-name:"Koptekst Char";
	mso-style-link:Koptekst;}
span.VoettekstChar
	{mso-style-name:"Voettekst Char";
	mso-style-link:Voettekst;}
span.BallontekstChar
	{mso-style-name:"Ballontekst Char";
	mso-style-link:Ballontekst;
	font-family:"Tahoma","sans-serif";}
span.HTML-voorafopgemaaktChar
	{mso-style-name:"HTML - vooraf opgemaakt Char";
	mso-style-link:"HTML - vooraf opgemaakt";
	font-family:"Courier New";}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple>

<div class=WordSection1>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:28.0pt;line-height:115%'>SimPyLC HowTo</span></b></p>

<p class=MsoNormal align=center style='text-align:center'>© 2013-2015 GEATEC
engineering, www.geatec.com</p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:12.0pt;line-height:115%'>Author: Jacques de Hooge</span></p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:12.0pt;line-height:115%'>Date: October 8th 2015</span></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:16.0pt;line-height:115%'>&nbsp;</span></b></p>

<p class=MsoTocHeading>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'><i><span
style='font-size:20.0pt;line-height:115%;color:#943634'>&quot;Simplicity is the
hallmark of the true&quot;</span></i></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoTocHeading>Table of contents</p>

<p class=MsoToc1>&nbsp;</p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067097"><span lang=EN-US>QQuickLicence
governing the use of SimPyLC and of its generated code</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067098"><span lang=EN-US>Introduction</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067099"><span lang=EN-US>GUI
quick reference</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067100"><span lang=EN-US>Putting
together a simulation</span><span style='color:windowtext;display:none;
text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067101"><span lang=EN-US>Basic
control elements</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>6</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067102"><span lang=EN-US>The
PLC programming paradigm</span><span style='color:windowtext;display:none;
text-decoration:none'>.. </span><span
style='color:windowtext;display:none;text-decoration:none'>8</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067103"><span lang=EN-US>PLC
programming rules</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>10</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067104"><span lang=EN-US>What
is wrong with encapsulation and control structures?</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>12</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067105"><span lang=EN-US>But
what makes controlling a robot system so different?</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>13</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067106"><span lang=EN-US>Control
levels</span><span style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>14</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067107"><span lang=EN-US>Putting
a robot system into active operation</span><span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>15</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067108"><span lang=EN-US>The
SimPyLC simulator</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>16</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067109"><span lang=EN-US>Assignment</span><span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></span></p>

<p class=MsoToc1><span lang=NL><a href="#_Toc432067110"><span lang=EN-US>Code generation
for the Arduino</span><span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>18</span></a></span></p>

<p class=MsoNormal><span lang=NL>&nbsp;</span></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067097">QQuickLicence governing the use of SimPyLC and of
its generated code</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>This license governs use of the accompanying software
(&quot;Software&quot;), and your use of </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>the Software constitutes acceptance of this license.</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>You may use the Software for any commercial or noncommercial purpose,
including </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>distributing derivative works.</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>In return, it is required that you agree:</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>1.  Not to remove any copyright or other notices from the Software. </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>2.  That if you distribute the Software in source code form you do so
only under</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    this license (i.e. you must include a complete copy of this license
with your</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    distribution in a plain text file named QQuickLicence.txt),</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    and if you distribute the Software solely in object form</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    you only do so under a license that complies with this license. </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>3.  That the Software comes &quot;as is&quot;, with no warranties. None
whatsoever. This </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    means no express, implied or statutory warranty, including without
limitation, </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    warranties of merchantability or fitness for a particular purpose
or any </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    warranty of title or non-infringement. Also, you must pass this
disclaimer on </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    whenever you distribute the Software or derivative works. </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>4.  That neither Geatec Engineering nor any contributor to the Software
will be liable for any </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    of those types of damages known as indirect, special,
consequential, or </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    incidental related to the Software or this license, to the maximum
extent the law </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    permits, no matter what legal theory it's based on. Also, you must
pass this </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    limitation of liability on whenever you distribute the Software or
derivative </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    works.</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>5.  That you will not use or cause usage of the Software in
safety-critical situations</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    under any circumstances.</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>6.  That if you sue anyone over patents that you think may apply to the
Software for a </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>    person's use of the Software, your license to the Software ends
automatically. </p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>7.  That your rights under this License end automatically if you breach
it in any way.</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'>8.  That all rights not expressly granted to you in this license are
reserved.</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067098">Introduction</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>This document briefly describes the functions of the SimPyLC
control simulator. Purpose of the simulator is to allow students to get
acquainted with the design of real time controls for automated production and
transportation systems. The controlled systems may range from out of the box
assembly line robots to special purpose robot cranes and automatically
controlled transportation vehicles.</p>

<p class=MsoNormal>Real time control of such systems often utilize a PLC
(Programmable Logic Controller). A PLC has to perform a lot of tasks in
parallel. It does so using design patterns that are very different from the
ones used in mainstream design of non-control programs. When it comes to
performing tasks in parallel, traditionally things like interprocess
communication, threads, semaphores, queues en critical sections may come to
mind.</p>

<p class=MsoNormal>Synchronizing tasks by means of these facilities is error
prone. Problems may range from deadlocks, where processes are waiting for each
other forever, to race conditions, where it's unclear which action will be
performed first. Use of queues as means of interprocess communication opens the
possibility of control commands being accumulated unwantedly, taking effect at
an unexpected moment. Suddenly the system (which may be as small as an
electronics welding robot, but also as big as a container crane) starts
executing a movement, which may  be very dangerous.</p>

<p class=MsoNormal>Safety plays a major role in designing real time control
systems. Even a small production robot may cause harm in an environment where
also human labor is being performed. The main demand to be made on a real
control system is that the environment is being watched constantly and that
actions are not solely dictated by supervisory commands and previous program
state, but also by constant evaluation of sensor input from the environment.</p>

<p class=MsoNormal>To be able to experiment with controlling real hardware, a
code generator for the well known Arduino processor board has been added. <b>Note
that the simulator as well as the code generator may contain bugs. So the
generated code is only suitable for educational purposes and controlled systems
should be chosen not to pose any risk of damage or injury in case of control
malfunction.</b> A control can be simulated in advance and when it is ready, C
code can be generated and uploaded to the Arduino.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067099">GUI quick reference</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>[LEFT CLICK] on a field to freeze, type to edit, [RETURN] 
or [LEFT CLICK] to accept, [ESC] or [RIGHT CLICK] to accept and thaw.</p>

<p class=MsoNormal>Set the 'run' marker to 0 to stop the clock, set it to 1 to
start the clock again.</p>

<p class=MsoNormal>[PGDN] to go to next control page, [PGUP] to go to previous
one.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:115%;
font-family:"Cambria","serif";color:#365F91'>&nbsp;</span></b></p>

<h1><a name="_Toc432067100">Putting together a simulation</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Two  example simulations are part of the SimPyLC
distribution.</p>

<p class=MsoNormal><u>The one to start with is in the <i>blinkingLight</i>
directory</u>. To understand what is happening, run the example in that
directory from the command line: <i>python world.py</i>. Look at the sourcecode
in <i>blinkingLight.py</i> and at the sequence diagram of the running
application to see causes and effects. Also take a look at <i>timing.py</i> to
see how the sequence diagram is defined and at <i>world.py</i> to see how the
parts of the simulation are tied together.</p>

<p class=MsoNormal><u>The second example is in the <i>oneArmedRobot  </i>directory</u>,
and consists of the following files:</p>

<p class=MsoNormal><i>world.py</i>                             Defines the
parts that make up the simulation</p>

<p class=MsoNormal><i>robot.py</i>                             A SimPyLC module
that simulates the physics of a production robot</p>

<p class=MsoNormal><i>control.py</i>                          A SimPyLC module
that contains the control software for the robot</p>

<p class=MsoNormal><i>visualisation.py</i>                               Contains
an OpenGL visualisation of the robot</p>

<p class=MsoNormal><i>timing.py</i>                            Draws sequence
diagrams of selected signals</p>

<p class=MsoNormal>Start the example simulation from the command line in the
same way as the first example: <i>python world.py</i>. Play around with it. A
control element gets in the input state by a [left click] or by pressing <i>[enter].</i>
Then you can input a value. <i>[Left click]</i>ing or pressing <i>[enter]</i>
again will force the control element to retain the value you specified. <i>[Right
click]</i>ing or pressing <i>[esc]</i> will release the control element,
allowing it to be overwritten.</p>

<p class=MsoNormal>Start by reading through robot.py using the circuit
descriptions above, and try to find out what makes it tick. Then shift your
attention to control.py for a little more complexity. Pay special attention to
the <b><span style='color:#984806'>input</span></b> methods of both the <b><span
style='color:#984806'>Robot</span></b> and <b><span style='color:#984806'>Control</span></b>
class, to gain insight in how these modules (both inherit from class <b><span
style='color:#984806'>Module</span></b>) exchange control signals.</p>

<p class=MsoNormal>Then take a brief look to into <i>visualisation.py</i> to
find out how a so called hierarchical model works. Peek into the file <i>graphics.py</i>
to see how OpenGL is involved. Google for &quot;OpenGL Hierarchical
Modeling&quot; to find many explanations of how this works.</p>

<p class=MsoNormal>Also take a look at <i>timing.py</i> to see how the channels
of the sequence diagram are configured.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><b><span style='font-size:14.0pt;line-height:115%;
font-family:"Cambria","serif";color:#365F91'>&nbsp;</span></b></p>

<h1><a name="_Toc432067101">Basic control elements</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>class Marker:</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                </span></b><b><span
style='color:#00B050'># Boolean expression evaluator</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def __init__ (self,
condition = False):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Sets
the boolean value of the marker to  condition</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def mark (self, trueValue,
condition = True, falseValue = None):</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'># Sets the boolean value of the register to trueValue if
condition is True</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'># Sets the boolean value of the register to falseValue
if:</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - condition is False</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             and</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - parameter falseValue is present and not
None</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'># Leaves the boolean value of the register unaltered if:</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - condition is False</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             and</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - parameter falseValue is absent or None</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>class Oneshot:</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                </span></b><b><span
style='color:#00B050'># Edge detector</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def __init__ (self,
condition = False):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                </span></b><b><span
style='color:#00B050'>                # Initializes the boolean value of the
oneshot to condition      </span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def trigger (self,
condition):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Sets
the boolean value of the oneshot to True if:</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               #             -
condition is True</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               #             and</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               #             -
condition was False previously</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Resets
theboolean value of the oneshot to False in all other cases</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # So a
oneshot can only remain True for at most one sweep</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>class Latch:</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                # Boolean memory cell</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def __init__ (self,
condition = False):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Sets
the boolean value of the latch to condition</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def latch (self,
condition):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Sets
the boolean value of the latch to True if condition is True</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Leaves
it unaltered if condition is False</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def unlatch (self,
condition):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Sets
the boolean value of the latch to  False if condition is True</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Leaves
it unaltered if condition is False</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>&nbsp;</span></b></p>

<b><span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif";
color:#984806'><br clear=all style='page-break-before:always'>
</span></b>

<p class=MsoNormal><b><span style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>class Register :</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                </span></b><b><span
style='color:#00B050'># Numerical expression evaluator</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def __init__ (self,
value = 0):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>                               # Sets
the numerical value of the register to value</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def set (self,
trueValue, condition = True, falseValue = None):</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'># Sets the numerical value of the register to trueValue
if condition is True</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'># Sets the numerical value of the register to falseValue
if:</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - condition is False</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             and</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - parameter falseValue is present and not
None</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'># Leaves the numerical value of the register unaltered
if:</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - condition is False</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             and</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>#             - parameter falseValue is absent or None</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt;text-indent:35.4pt;line-height:normal'><b><span
style='color:#00B050'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:70.8pt;margin-bottom:.0001pt;line-height:normal'><b><span
style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>class Timer:</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                </span></b><b><span
style='color:#00B050'># Total elapsed timer</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def __init__ (self):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                               </span></b><b><span
style='color:#00B050'># Resets the seconds value of timer to 0</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def reset (self,
condition):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                               </span></b><b><span
style='color:#00B050'># Resets the seconds value of timer to 0 if condition is
True</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#00B050'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='color:#00B050'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>class Runner:</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                </span></b><b><span
style='color:#00B050'># Special singleton Marker allows freezing a simulation 
by halting the clock</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                def __init__ (self,
condition = True):</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><b><span style='color:#984806'>                               </span></b><b><span
style='color:#00B050'># Sets the boolean value of the runner to True</span></b></p>

<b><span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif";
color:#00B050'><br clear=all style='page-break-before:always'>
</span></b>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#00B050'>&nbsp;</span></b></p>

<h1><a name="_Toc432067102">The PLC programming paradigm</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>PLC software, whether running on special hardware or on a
PC, adheres to some very simple rules that seem overly strict at first sight.
However in practice it has turned out that following these rules lead to stable,
predictable system behavior. So for one moment let's forget the richness of
modern programming languages and operating systems and delve into a very
different world: The world of real time control software.</p>

<p class=MsoNormal>Central in each PLC program is a loop that is executed
forever. In a general purpose programming language the code is something like:</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>while True:</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><b><span style='color:#984806'>readInputFromSensorsAndControls
()         </span></b><b><span style='color:#00B050'># Controls can be
switches, commands etc.</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><b><span style='color:#984806'>calculateOutputFromInputAndPreviousState
()</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><b><span style='color:#984806'>writeOutputToActuatorsAndIndicators
()</span></b><span style='color:#00B050'>   </span><b><span style='color:#00B050'>#
Indic. can be lamps, meters, status reports etc.</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><span style='font-family:"Times New Roman","serif";
color:#00B050'>&nbsp;</span></p>

<p class=MsoNormal>PLC's have their own terminology. Going through the above
loop once is called a <b>sweep</b>. The time it takes to perform one sweep is
called the sweeptime. In the simulator, the sweeptime is available in the
variable <b><span style='color:#984806'>World.period</span></b>. The sweeptime
determines the reaction time of the PLC. It may range from a few to a few dozen
milliseconds.</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Within one sweep, at first all input from sensors, operator
controls and external control systems is read. This is indicated by the
function <b><span style='color:#984806'>readInputFromSensorsAndControls ()</span></b>.
</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Next all output signals are computed from the inputs and from the
previous control state. This is indicated by the function <b><span
style='color:#984806'>calculateOutputFromInputAndPreviousState ()</span></b>.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Finally, in the function <b><span style='color:#984806'>writeOutputToActuatorsAndIndicators
()</span></b>, the outputs are transferred to the outside world, e.g. servo
motors, electromagnets, indicator lamps to inform human s or signals and
reports for external control systems.</p>

<p class=MsoNormal>After this, the whole sequence starts all over again: the
next sweep. In a real world PLC, the sweeptime is guarded by a watch dog timer.
If it exceeds a maximum, the system is brought to a halt in a safe manner. </p>

<p class=MsoNormal>What is crucial to the way PLC programs operate, is that all
inputs are read at the start of every sweep. So what e.g. is bad style for a
PLC program, is to have a sensor report transient information. For instance as
long as the robot does not hit limit switch s1, this leads to a <b>continuous</b>
input <b><span style='color:#984806'>s1Enabled</span></b> rather than having a
brief spike <b><span style='color:#984806'>s1Hit</span></b> at the moment the
robot hits the limit switch. The advantage is that is case of sensor malfunction
or software glitches, the system will come to a halt, rather than run out of
control.</p>

<p class=MsoNormal>To get a better feeling for the benefits of this approach,
lets look for a moment at the oil level indicator light in a car. The worst
design is a lamp that only briefly lights up if the car runs out of oil. The
driver will almost certainly miss this transient information. A little better
is a lamp that will remain burning as long as the oil level remains too low.
From the standpoint of system failure however, a green lamp that burns as long
as the oil level is ok, is preferable, for if the lamp itself fails, the driver
will halt the car, thereby avoiding the risk of damaging the engine by lack of
lubrication. Since a lamp switching off draws less attention than a lamp
switching on, a solution where a green light indicates enough oil and a red or
blinking light or no light at all (lamp failure) indicates a problem, is
probably the optimum.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067103">PLC programming rules</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>The first step in programming safe controls is to follow a
couple of rules. As said, these rules seem very strict, even unworkable and
draconic at first. But let firsthand experience be your teacher here. Follow
them consequently in your designs and  it will quite soon become clear what the
benefits are. Here are the rules:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>No
loops other than the main sweep. So no <b><span style='color:#984806'>while</span></b>,
<b><span style='color:#984806'>for</span></b>, <b><span style='color:#984806'>repeat</span></b>,
<b><span style='color:#984806'>goto</span></b> etc.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>No
conditional statements. So no <b><span style='color:#984806'>if</span></b>,<b> </b><b><span
style='color:#984806'>elif</span></b>, <b><span style='color:#984806'>else</span></b>,
<b><span style='color:#984806'>switch</span></b>, <b><span style='color:#984806'>case</span></b>
etc.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Be
brief and concise</p>

<p class=MsoNormal><b>In short: No control structures at all!</b></p>

<p class=MsoNormal>How can anyone make any real world computer program like
this? Surely control structures have not been a part of every mainstream
language right from the advent of computing for no purpose... All that you can
do without them is evaluate and assign expressions. How to control anything by
doing only that?</p>

<p class=MsoNormal>Well, the answer is that there certainly is a category of
languages that lacks imperative control structures, in fact it lacks imperative
statements at all. This category is the category of <b>functional languages</b>.
Functional languages boil down to stating functional dependencies between input
and output. Functional languages are generally considered to hold great promise
when it comes to system reliability. But they are also considered to be strange
beasts, only to be comprehended by mathematicians that talk to their wives in
formulae.</p>

<p class=MsoNormal>It is the functional programming paradigm that PLC controls
borrow their reliability from. The most reliable PLC control is a PLC control
where the output of one sweep is a mere function of its instantaneous input,
not relying on any state from previous  sweeps. This statelessness is what
makes functional programs reliable and easily testable.</p>

<p class=MsoNormal>In practice, PLC programs do retain state from previous
sweeps in the form of registers, latches and oneshots, to be discussed later.
However, the less state is retained, the more reliable the control, even when
this  means that some seemingly redundant computations are done over and over
again in every sweep.</p>

<p class=MsoNormal>The golden bullet of designing reliable control programs is
to know when to retain state and when not. This is a matter of common sense and
experience. The former boils down to a choice: get acquainted with the textbook
way of programming in any 3rd generation language (C, C++, Python, C#, Java,
JavaScript, Fortran, Basic, Pascal, Modula, Ada) using all the bells and
whistles that these ever growing languages offer. After that, imagine yourself
standing next to a 40 ton coal grab unloader, swaying at full speed at four
meter distance from your head, controlled by a computer. And ask yourself: how
much program complexity do I dare to trust my life to. The latter, experience,
is what you hopefully will gain by building robot controls using the simulator.</p>

<p class=MsoNormal>The third point of the PLC programming rules, be brief and
concise, is probably the most important one. One way to obtain reliable
software is intervision. Such intervision, called deskchecking or peer
reviewing if software is involved, relies on the observation that explaining
something to another person is a very good way to reach a thorough
understanding of it yourself. You and a colleague go through the program step
by step. Explain to your colleague what you have done and why, and you'll
discover your own mistakes. And maybe your colleague will discover some too,
but that's just a bonus.</p>

<p class=MsoNormal>To be able to go through a program in this way, it must not
be too bulky. Reading through ten pages of sourcecode and keeping track of the
interactions is doable. Reading through twohundred pages will make you lose
track. Encapsulation techniques like object oriented programming are one way to
tackle complexity. Another way is simplicity. PLC programs tend to be simple,
and, strange enough, they tend to be brief. This is counterintuitive. Certainly
being restricted to a small subset of program structures will lead to lengthy
sourcecode? In practice this turns out not to be the case. Why this is so is
the subject of the next two paragraphs.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067104">What is wrong with encapsulation and control
structures?</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>What is wrong with encapsulation and control structures? Well,
nothing of course, encapsulation is hiding local and volatile design decisions
behind a well defined stable interface. It is the cornerstone of object
oriented programming and is quite successful if applied at the right occasions.</p>

<p class=MsoNormal>PLC's use encapsulation intensively. The &quot;electrical
circuit&quot;-like elements that make up a PLC program (timers, registers,
latches, oneshots etc.) are all instances of classes, hiding their internal
complexity behind a very simple and well defined interface.</p>

<p class=MsoNormal>But this is system software, which means: it is thoroughly
tested part of the PLC itself, not of the ever changing control programs you
write for it. So encapsulation does its work behind the scenes.</p>

<p class=MsoNormal>Something similar holds for control structures like loops (<b><span
style='color:#984806'>while</span></b>, <b><span style='color:#984806'>for</span></b>,
<b><span style='color:#984806'>repeat</span></b>, <b><span style='color:#984806'>goto</span></b>)
and conditional statements (<b><span style='color:#984806'>if</span></b>,<b> </b><b><span
style='color:#984806'>elif</span></b>, <b><span style='color:#984806'>else</span></b>,
<b><span style='color:#984806'>switch</span></b>, <b><span style='color:#984806'>case</span></b>).
The whole PLC concept revolves around one central loop, the sweep. And to
facilitate efficient IO, even the dreaded multithreading and interprocess
communication are utilized by the PLC itself. And of course the system software
that is a fixed, non user programmable part of any  PLC, uses conditional
statements. But as said: this complexity is restricted to exhaustively tested
system software in any real PLC (as opposed to a simulator for learning
purposes).</p>

<p class=MsoNormal>The control program running on top of this system software
should be simple, straight and brief. Fortunately, switching from a typical
object oriented programming style to the straight and simple style that is the
norm for real time controls, lessens the amount of sourcecode. Program size tends
to shrink from hundreds of pages of sourcecode to tens of pages. The fact that
this is so, is not caused by any flaw of object oriented programming, but by the
rather unusual characteristics of robot controls, as explained in the next
paragraph.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067105">But what makes controlling a robot system so
different?</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Good question! Real time control programs <b>are </b>different
from mainstream programming. In a nutshell, here's why. A robot control
generally has the following properties:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
amount of sensor signals (inputs from the outside world) typically is four
times the amount of actuator signals (outputs to motors, magnets, welding
electrodes, paint sprayers etc.). So a control system e.g. needs input from
forty sensors to control only ten actuators.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To
determine any of the outputs, typically almost all sensor signals are needed,
either directly or indirectly. Look at yourself as a robot. For even a routine
task like determining when to put the fire low when roasting meat, you'll use
sight, hearing, smell and tactile input. For automated control systems it turns
out to be the same in practice.</p>

<p class=MsoNormal>Let's see what this means for noble concepts like
encapsulation on the application (rather than internal PLC system) level. Since
every output depends upon tens or hundreds of inputs, the public interface of
classes in object oriented controls (or the parameter lists in function
structured controls) turns out to be excessively large.</p>

<p class=MsoNormal>Another observation is that while control program parts for
e.g. the upper arm, the forearm and the wrist of a robot control at first sight
look similar, in practice they differ in minute but essential ways. So at best
they can be modeled by related classes using inheritance. But the differences
are ad hoc and may change completely during the productive life of the control
system, if e.g. safety switches are added or a new sequence of robot acts
becomes necessary to manufacture an altered or new product. There's a tendency
for changes like that to completely wreck even the most carefully designed
inheritance hierarchy.</p>

<p class=MsoNormal>The only weapon here is simplicity. Work straight towards
the task at hand without additional restrictions like stable interfaces, since
they will make the program grow manifold, to be prepared for an unknown future.</p>

<p class=MsoNormal>At this point some relativation and reservation is needed.
Program design is striking the right compromises. All the rules so forcefully
advocated above have exceptions. Pragmatism is to be preferred over dogmatism,
especially with control systems.  And there are control systems that do not fit
well with the rules stated above. Keep reading.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067106">Control levels</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>In order to determine what approach will work best, it's
needed to be aware of the following control hierarchy:</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>4</p>
  </td>
  <td valign=top style='border:solid windowtext 1.0pt;border-left:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Logistic control level</p>
  </td>
  <td valign=top style='border:solid windowtext 1.0pt;border-left:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Planning sequences to achieve a final goal: Load all the boxes from
  the stockpile on the left upon the palette on the right.</p>
  </td>
 </tr>
 <tr>
  <td width=157 valign=top style='width:117.8pt;border:solid windowtext 1.0pt;
  border-top:none;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>3</p>
  </td>
  <td width=157 valign=top style='width:117.8pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Sequence control level</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Chaining atomary commands to achieve an intermediate goal. E.g.
  displacement: Grab that box and put it overthere.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>2</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Direct control level</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Execute atomary commands like: Grab that box. Or: Put it over there.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>1</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Hardwired locking level</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Maintain safety by means of hard wired negative (often tactile) sensors.
  No signal means: Stop .</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>0</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Inherent safety level</p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
  normal'>Physical prevention of accidents: Arm not long enough to reach operator.
  Concrete buffer at the end of the track.</p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>It's the levels 2 and 3 that the PLC programming style
treated in the previous paragraphs is most suitable for. Level 4 is better
tackled using mainstream object- or data-oriented programming. Level 1 is the
domain of special purpose hard wired electrical circuits and a limited amount
of simple and robust sensors. Level 0 is the level where the quay turns the
ship.</p>

<p class=MsoNormal>Apart from the above hierarchy, there's a tendency for
functionality to move from the control itself into the sensors and actuators.
High speed feedback loops are part of the servo motors driving the robot's
movements, rather than of the central program. The same holds e.g. for
numerical integration of accelerometer data to obtain speed and position. As
far as these intelligent actuators and sensors are robust, the trend towards
decentralization is beneficial, since it replaces expensive and vulnerable
special purpose software by out-of-the-box components. However it may be
desirable for the central control to keep a watchful eye on these intelligent components,
since the central control is the one able to combine all input information and
draw conclusions, e.g. about sensor failure.</p>

<p class=MsoNormal>Keeping the possibility of sensor failure in mind, it may
seem like a good idea to have lots of redundancy in the sensorical capabilities
of the robot, but there's a downside to this. If sensors differ of opinion,
what should the control do? Halt the system? But that often means halting
production. The more sensors are present, the more sensor failure will occur.
In some situations a minor chance on limited damage is to be preferred over a
robot that regularly blocks a whole production line for no reason other than
failure of a redundant sensor.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067107">Putting a robot system into active operation</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Imagine a production line of a car manufacturer. The keyword
here is: uptime. Every unproductive quarter costs a car worth of money. So you
carefully design your control program and, even better, you test it in advance
by means of simulation, typically reducing the time to get the robot up and
running from weeks to hours. But still.</p>

<p class=MsoNormal>Real world circumstances differ from the information
(requirements)  you got in advance. The adjustment of the conveyor belt is more
inexact than was specified. Reflections and direct sunlight misguide your
optical sensors. Temperature changes of the environments lead to needless emergency
stops, as the control is fooled into thinking that the welding transformer is
overheated. And so on. It shouldn't be so, but it is. Always.</p>

<p class=MsoNormal>There are two ways of dealing with this. One way is hiding
behind hundred page contracts, drawn up by your companies law department. Any
differences from specification? Tough luck for the customer. Claims won't
apply, it's all excluded by the legal guys. As an unfortunate side effect
however, there will be no more assignments from this customer. Tough luck for
your company. Because that's what industrial control programming practice is
like. Either live in the real, physical, unpredictable, ever changing world in
which your robot control has to live, or don't.</p>

<p class=MsoNormal>Fortunately most companies are aware of the fact that
customers are not merely a nuisance. So their practical needs will have to be
met. And those needs include ad hoc change and minimal disruption of
production.</p>

<p class=MsoNormal>What this means for robot control programs is the need for
efficient debugging and alteration. You will have to be able to experiment and
repair on the spot, under the real circumstances, interacting with real
hardware and other automated systems.</p>

<p class=MsoNormal>To this end, every PLC control allows for real time
inspection and alteration of all control objects (timers, latches, oneshots,
registers etc.). Arbitrary values can be input during active operation, all
values can constantly be monitored by the operator and, last but not least,
values can be forced permanently. This means that rather than acquiring an input
signal value from a sensor, or computing an intermediate value or outputing a
signal value to an actuator, these signals are coerced to have a certain value.
This makes rapid, real time, testing and debugging feasible.</p>

<p class=MsoNormal>That's  what all the blinking lights and fluctuating numbers
on a control rack are about, not about trying to look like StarTrek, but to
both know what's going on and be able to influence it in real time.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067108">The SimPyLC simulator</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>There are many PLC simulators available for free. Most of them
good looking and feature rich. Why another simulator? The Sim in SimPyLC stands
for simulation, but it also stands for simple. SimPyLC is a simplified version
of its C++ counterpart SimPLC, written by the same author, that has been  in
use in the industry controlling installations ranging from harbor cranes  to
chemical production facilities for over twenty years now. SimPyLC  is completely
written in Python. What this means is that there's so little sourcecode, that
you can read through every line of it, if you want. </p>

<p class=MsoNormal>You can dissect it, alter it to your needs and taste and
understand every single line of code. The amount of insight this will give
cannot be matched be any theoretical explanation of what such code should do.
At first try to write some simple controls using SimPyLC. Use the example code
(one-armed production robot) as tutorial material.</p>

<p class=MsoNormal>Then go on with the more complex assignments. And, if
there's a need or an opportunity, take a peek at the sourcecode of SimPyLC
itself. So you'll know that there's no magic involved. The goal is to gain the
insight and confidence that you could have written it yourself and that you
understand exactly how it behaves and why. This is how PLC's work. And
hopefully the assignments make clear why these simple and robust control
devices are ubiquitous in the world of industrial production and logistics.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1><a name="_Toc432067109">Assignment</a></h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>As a starting point in learning to program real time
controls, after you understand the code of all simulation examples, you may try
to optimize the <i>oneArmedRobot</i> control. Especially the torso movement has
a lot of overshoot. This is because it is programmed without paying any attention
to the underlying physics.</p>

<p class=MsoNormal>In general, movements are governed by the following
equations:</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>s(t)
= s(0) + v(0) t + 1/2 a(0) t^2           [1]</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>v(t)
= v(0) + a(0) t                          [2]</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>v(t)
= 0                                      [3]</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>[2]
&amp; [3]      0 ==&gt; v(0) + a(0) t            [4]</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>[4]     ==&gt;     t
= - v(0) / a(0)              [5]</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>s(t)
= 0                                      [6] </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>[1]
&amp; [5] &amp; [6] ==&gt;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>0
= s(0) + v(0)(- v(0) / a(0) + 1/2 a(0) (v(0)^2 / a(0)^2)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>0
= s(0) - v(0)^2 / a(0) + 1/2 v(0)^2 / a(0)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>0
= s(0) + (- 1 + 1/2) v(0)^2 / a(0)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>0
= s(0) - 1/2 v(0)^2 / a(0)</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:10.0pt;font-family:"Courier New";color:black'>s(0)
= 1/2 v(0)^2 / a(0)</span></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Where:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:"Courier New"'>t</span> is time</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:"Courier New"'>s</span> is position or
angle</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:"Courier New"'>v</span> is velocity or
angular velocity</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:"Courier New"'>a</span> is acceleration
or angular acceleration</p>

<p class=MsoNormal><span style='font-family:"Courier New"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Courier New"'>s(0)</span> denotes
the braking distance. A fast control will:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Accelerate towards the target maximally if further away from the
target than the braking distance.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-18.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Accelerate away from the target (decelerate towards the target)
maximally if closer to the target than the braking distance</p>

<p class=MsoNormal>Try to implement such a bang-bang control in the <i>oneArmedRobot</i>
example. Although this boils down to changing just a few lines of code, it is
not as easy as it may seem. You'll have to pay good  attention to direction. If
you've done this properly, you'll find that no visible overshoot remains and
positioning becomes very fast. This is the way e.g. gantry cranes are
positioned. The bang-bang effect is damped by the power electronics and
inertness of the mechanics in practice if the PLC sweeptime is short enough.<a
name="_Toc432067110"></a></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1>Code generation for the Arduino</h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>To enable controlling real hardware, C code generation for
the Arduino processor board has been added. This is a recent feature and has
not yet been tested thoroughly. Still, in an educational situation, it is an
interesting possibility. Code can be designed and tested using the simulator.
Once it's functioning well, it can be uploaded to the Arduino.</p>

<p class=MsoNormal>After simulation gives satisfactory results, add the
modulenames for which one wants to generate code to the command line.</p>

<p class=MsoNormal style='margin-left:35.4pt'><i>python world.py robot</i></p>

<p class=MsoNormal>If you want to generate code for all modules, use:</p>

<p class=MsoNormal style='margin-left:35.4pt'><i>python world.py *</i></p>

<p class=MsoNormal>To avoid name clashes a prefix can be added to all generated
identifiers, e.g.</p>

<p class=MsoNormal style='margin-left:35.4pt'><i>python world.py * prefix=PLC</i></p>

<p class=MsoNormal>will prefix all generated identifiers with <i>PLC_</i>.</p>

<p class=MsoNormal>In all cases the name of the generated C file will be <i>&lt;simulationDirectoryName&gt;.c</i>.</p>

<p class=MsoNormal>To upload your code to the Arduino, assuming you use the
prefix PLC:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-18.0pt'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Copy
all generated C code to the clipboard</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open
the Arduino IDE and copy it at the beginning of a new sketch</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-18.0pt'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In
the <i>loop </i>function:</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:72.0pt;text-indent:-18.0pt'>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>copy
input data from Arduino inputs to PLC variables</p>

<p class=MsoListParagraphCxSpMiddle style='margin-left:72.0pt;text-indent:-18.0pt'>b.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span> call
the generated PLC_<i>cycle () </i>function</p>

<p class=MsoListParagraphCxSpLast style='margin-left:72.0pt;text-indent:-18.0pt'>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>copy
output from PLC outputs to Arduino outputs</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Calibri","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>The <i>arduinoLed</i> example simulation operates the
onboard Arduino light emitting diode. The generated code should be added to an
empty sketch, calling <i>PLC_cycle ()</i> in the main <i>loop</i>:</p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#00B050'>// ======================== BEGIN OF GENERATED CODE
========================</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>... Lots of generated code here...</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#00B050'>// ======================== END OF GENERATED CODE
========================</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#00B050'>//  the setup function runs once when you press reset or
power the board</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>void setup  ()  {</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><b><span style='color:#984806'>pinMode
 (13, OUTPUT);</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>}</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#00B050'>// the loop function runs over and over again forever</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>void loop () {</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><b><span style='color:#984806'>PLC_cycle
();     </span></b><b><span style='color:#00B050'>// Call PLC main loop</span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:35.4pt;margin-bottom:.0001pt'><b><span style='color:#984806'>digitalWrite
(13, PLC_led);  </span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>}</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
style='color:#984806'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>Note that writing non-trivial controls like the <i>oneArmedRobot</i>
using SimPyLC is <b>much</b> simpler than programming the Arduino in C
directly. The test facilities of SimPyLC contribute a lot to this, as does the
presence of circuit element types like Oneshot and Timer.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>Take your time to really grab the PLC coding style as
exemplified in <i>oneArmedRobot</i>, using simulation and timing charts to
debug your control even before the hardware is available and you'll soon be
writing complex controls with a minimum of effort.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>N.B.1 : ARDUINO CODE GENERATION IS STILL HIGHLY
EXPERIMENTAL AND BOUND TO CONTAIN SOME NASTY BUGS. PLEASE REPORT THEM SHOULD
YOU FIND ANY.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>N.B. 2: NOTE THAT, IN ACCORDANCE WITH THE LICENCE, IT IS
PROHIBITED TO USE THE SIMULATOR OR THE GENERATED CODE IN ANY SITUATION WHERE
DAMAGE OR INJURY MAY ARISE, EITHER FROM CONTROL MALFUNCTION OR OTHERWISE.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
style='color:black'>&nbsp;</span></p>

<p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
text-align:center'>--//--</p>

<p class=MsoNormal style='margin-bottom:6.0pt;line-height:normal'><b>&nbsp;</b></p>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
