

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>auditok API Tutorial &mdash; auditok 0.1.4 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="auditok 0.1.4 documentation" href="index.html"/>
        <link rel="next" title="auditok.core" href="core.html"/>
        <link rel="prev" title="auditok Command-line Usage Guide" href="cmdline.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> auditok
          

          
          </a>

          
            
            
              <div class="version">
                0.1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cmdline.html">   Command-line Usage Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">   API Tutorial</a><ul class="simple">
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core.html">   auditok.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">   auditok.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">   auditok.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">   auditok.dataset</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">auditok</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li><cite>auditok</cite> API Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/apitutorial.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="auditok-api-tutorial">
<h1><a class="toc-backref" href="#id3"><cite>auditok</cite> API Tutorial</a><a class="headerlink" href="#auditok-api-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first"><cite>Contents</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#auditok-api-tutorial" id="id3"><cite>auditok</cite> API Tutorial</a><ul>
<li><a class="reference internal" href="#illustrative-examples-with-strings" id="id4">Illustrative examples with strings</a><ul>
<li><a class="reference internal" href="#extract-sub-sequences-of-consecutive-upper-case-letters" id="id5">Extract sub-sequences of consecutive upper case letters</a></li>
<li><a class="reference internal" href="#tolerate-up-to-two-non-valid-lower-case-letters-within-an-extracted-sequence" id="id6">Tolerate up to two non-valid (lower case) letters within an extracted sequence</a></li>
<li><a class="reference internal" href="#remove-trailing-silence" id="id7">Remove trailing silence</a></li>
<li><a class="reference internal" href="#limit-the-length-of-detected-tokens" id="id8">Limit the length of detected tokens</a></li>
</ul>
</li>
<li><a class="reference internal" href="#auditok-and-audio-data" id="id9"><cite>auditok</cite> and Audio Data</a></li>
<li><a class="reference internal" href="#examples-using-real-audio-data" id="id10">Examples using real audio data</a><ul>
<li><a class="reference internal" href="#extract-isolated-phrases-from-an-utterance" id="id11">Extract isolated phrases from an utterance</a></li>
<li><a class="reference internal" href="#trim-leading-and-trailing-silence" id="id12">Trim leading and trailing silence</a></li>
<li><a class="reference internal" href="#online-audio-signal-processing" id="id13">Online audio signal processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contributing" id="id14">Contributing</a></li>
<li><a class="reference internal" href="#license" id="id15">License</a></li>
</ul>
</li>
</ul>
</div>
<p><strong>auditok</strong>  is a module that can be used as a generic tool for data
tokenization. Although its core motivation is <strong>Acoustic Activity
Detection</strong> (AAD) and extraction from audio streams (i.e. detect
where a noise/an acoustic activity occurs within an audio stream and
extract the corresponding portion of signal), it can easily be
adapted to other tasks.</p>
<p>Globally speaking, it can be used to extract, from a sequence of
observations, all sub-sequences that meet a certain number of
criteria in terms of:</p>
<ol class="arabic simple">
<li>Minimum length of a <strong>valid</strong> token (i.e. sub-sequence)</li>
<li>Maximum length of a <strong>valid</strong> token</li>
<li>Maximum tolerated consecutive <strong>non-valid</strong> observations within
a valid token</li>
</ol>
<p>Examples of a non-valid observation are: a non-numeric ascii symbol
if you are interested in sub-sequences of numeric symbols, or a silent
audio window (of 10, 20 or 100 milliseconds for instance) if what
interests you are audio regions made up of a sequence of &#8220;noisy&#8221;
windows (whatever kind of noise: speech, baby cry, laughter, etc.).</p>
<p>The most important component of <cite>auditok</cite> is the <a class="reference internal" href="core.html#auditok.core.StreamTokenizer" title="auditok.core.StreamTokenizer"><tt class="xref py py-class docutils literal"><span class="pre">auditok.core.StreamTokenizer</span></tt></a>
class. An instance of this class encapsulates a <a class="reference internal" href="util.html#auditok.util.DataValidator" title="auditok.util.DataValidator"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.DataValidator</span></tt></a> and can be
configured to detect the desired regions from a stream.
The <a class="reference internal" href="core.html#auditok.core.StreamTokenizer.tokenize" title="auditok.core.StreamTokenizer.tokenize"><tt class="xref py py-func docutils literal"><span class="pre">auditok.core.StreamTokenizer.tokenize()</span></tt></a> method accepts a <a class="reference internal" href="util.html#auditok.util.DataSource" title="auditok.util.DataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.DataSource</span></tt></a>
object that has a <cite>read</cite> method. Read data can be of any type accepted
by the <cite>validator</cite>.</p>
<p>As the main aim of this module is <strong>Audio Activity Detection</strong>,
it provides the <a class="reference internal" href="util.html#auditok.util.ADSFactory" title="auditok.util.ADSFactory"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory</span></tt></a> factory class that makes
it very easy to create an <a class="reference internal" href="util.html#auditok.util.ADSFactory.AudioDataSource" title="auditok.util.ADSFactory.AudioDataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory.AudioDataSource</span></tt></a>
(a class that implements <a class="reference internal" href="util.html#auditok.util.DataSource" title="auditok.util.DataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.DataSource</span></tt></a>) object, be that from:</p>
<ul class="simple">
<li>A file on the disk</li>
<li>A buffer of data</li>
<li>The built-in microphone (requires PyAudio)</li>
</ul>
<p>The <a class="reference internal" href="util.html#auditok.util.ADSFactory.AudioDataSource" title="auditok.util.ADSFactory.AudioDataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory.AudioDataSource</span></tt></a> class inherits from
<a class="reference internal" href="util.html#auditok.util.DataSource" title="auditok.util.DataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.DataSource</span></tt></a> and supplies a higher abstraction level
than <a class="reference internal" href="io.html#auditok.io.AudioSource" title="auditok.io.AudioSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.io.AudioSource</span></tt></a> thanks to a bunch of handy features:</p>
<ul class="simple">
<li>Define a fixed-length <cite>block_size</cite> (alias <cite>bs</cite>, i.e. analysis window)</li>
<li>Alternatively, use <cite>block_dur</cite> (duration in seconds, alias <cite>bd</cite>)</li>
<li>Allow overlap between two consecutive analysis windows
(if one of <cite>hop_size</cite> , <cite>hs</cite> or <cite>hop_dur</cite> , <cite>hd</cite> keywords is used and is &gt; 0 and &lt; <cite>block_size</cite>).
This can be very important if your validator use the <strong>spectral</strong> information of audio data
instead of raw audio samples.</li>
<li>Limit the amount (i.e. duration) of read data (if keyword <cite>max_time</cite> or <cite>mt</cite> is used, very useful when reading data from the microphone)</li>
<li>Record all read data and rewind if necessary (if keyword <cite>record</cite> or <cite>rec</cite> , also useful if you read data from the microphone and
you want to process it many times off-line and/or save it)</li>
</ul>
<p>See <a class="reference internal" href="util.html#auditok.util.ADSFactory" title="auditok.util.ADSFactory"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory</span></tt></a> documentation for more information.</p>
<p>Last but not least, the current version has only one audio window validator based on
signal energy (:class:<a href="#id1"><span class="problematic" id="id2">`</span></a>auditok.util.AudioEnergyValidator).</p>
<div class="section" id="illustrative-examples-with-strings">
<h2><a class="toc-backref" href="#id4">Illustrative examples with strings</a><a class="headerlink" href="#illustrative-examples-with-strings" title="Permalink to this headline">¶</a></h2>
<p>Let us look at some examples using the <a class="reference internal" href="util.html#auditok.util.StringDataSource" title="auditok.util.StringDataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.StringDataSource</span></tt></a> class
created for test and illustration purposes. Imagine that each character of
<a class="reference internal" href="util.html#auditok.util.StringDataSource" title="auditok.util.StringDataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.StringDataSource</span></tt></a> data represents an audio slice of 100 ms for
example. In the following examples we will use upper case letters to represent
noisy audio slices (i.e. analysis windows or frames) and lower case letter for
silent frames.</p>
<div class="section" id="extract-sub-sequences-of-consecutive-upper-case-letters">
<h3><a class="toc-backref" href="#id5">Extract sub-sequences of consecutive upper case letters</a><a class="headerlink" href="#extract-sub-sequences-of-consecutive-upper-case-letters" title="Permalink to this headline">¶</a></h3>
<p>We want to extract sub-sequences of characters that have:</p>
<ul class="simple">
<li>A minimum length of 1 (<cite>min_length</cite> = 1)</li>
<li>A maximum length of 9999 (<cite>max_length</cite> = 9999)</li>
<li>Zero consecutive lower case characters within them (<cite>max_continuous_silence</cite> = 0)</li>
</ul>
<p>We also create the <cite>UpperCaseChecker</cite> with a <cite>read</cite> method that returns <cite>True</cite> if the
checked character is in upper case and <cite>False</cite> otherwise.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">StringDataSource</span><span class="p">,</span> <span class="n">DataValidator</span>

<span class="k">class</span> <span class="nc">UpperCaseChecker</span><span class="p">(</span><span class="n">DataValidator</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>

<span class="n">dsource</span> <span class="o">=</span> <span class="n">StringDataSource</span><span class="p">(</span><span class="s">&quot;aaaABCDEFbbGHIJKccc&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">UpperCaseChecker</span><span class="p">(),</span>
             <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">dsource</span><span class="p">)</span>
</pre></div>
</div>
<p>The output is a list of two tuples, each contains the extracted sub-sequence and its
start and end position in the original sequence respectively:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="p">[([</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">([</span><span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="s">&#39;J&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">],</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="tolerate-up-to-two-non-valid-lower-case-letters-within-an-extracted-sequence">
<h3><a class="toc-backref" href="#id6">Tolerate up to two non-valid (lower case) letters within an extracted sequence</a><a class="headerlink" href="#tolerate-up-to-two-non-valid-lower-case-letters-within-an-extracted-sequence" title="Permalink to this headline">¶</a></h3>
<p>To do so, we set <cite>max_continuous_silence</cite> =2:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">StringDataSource</span><span class="p">,</span> <span class="n">DataValidator</span>

<span class="k">class</span> <span class="nc">UpperCaseChecker</span><span class="p">(</span><span class="n">DataValidator</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>

<span class="n">dsource</span> <span class="o">=</span> <span class="n">StringDataSource</span><span class="p">(</span><span class="s">&quot;aaaABCDbbEFcGHIdddJKee&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">UpperCaseChecker</span><span class="p">(),</span>
             <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">dsource</span><span class="p">)</span>
</pre></div>
</div>
<p>output:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="p">[([</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="p">([</span><span class="s">&#39;J&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">],</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">21</span><span class="p">)]</span>
</pre></div>
</div>
<p>Notice the trailing lower case letters &#8220;dd&#8221; and &#8220;ee&#8221; at the end of the two
tokens. The default behavior of <a class="reference internal" href="core.html#auditok.core.StreamTokenizer" title="auditok.core.StreamTokenizer"><tt class="xref py py-class docutils literal"><span class="pre">auditok.core.StreamTokenizer</span></tt></a> is to keep the <em>trailing
silence</em> if it does not exceed <cite>max_continuous_silence</cite>. This can be changed
using the <cite>StreamTokenizer.DROP_TRAILING_SILENCE</cite> mode (see next example).</p>
</div>
<div class="section" id="remove-trailing-silence">
<h3><a class="toc-backref" href="#id7">Remove trailing silence</a><a class="headerlink" href="#remove-trailing-silence" title="Permalink to this headline">¶</a></h3>
<p>Trailing silence can be useful for many sound recognition applications, including
speech recognition. Moreover, from the human auditory system point of view, trailing
low energy signal helps removing abrupt signal cuts.</p>
<p>If you want to remove it anyway, you can do it by setting <cite>mode</cite> to <cite>StreamTokenizer.DROP_TRAILING_SILENCE</cite>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">StringDataSource</span><span class="p">,</span> <span class="n">DataValidator</span>

<span class="k">class</span> <span class="nc">UpperCaseChecker</span><span class="p">(</span><span class="n">DataValidator</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>

<span class="n">dsource</span> <span class="o">=</span> <span class="n">StringDataSource</span><span class="p">(</span><span class="s">&quot;aaaABCDbbEFcGHIdddJKee&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">UpperCaseChecker</span><span class="p">(),</span>
             <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">mode</span><span class="o">=</span><span class="n">StreamTokenizer</span><span class="o">.</span><span class="n">DROP_TRAILING_SILENCE</span><span class="p">)</span>

<span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">dsource</span><span class="p">)</span>
</pre></div>
</div>
<p>output:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="p">[([</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;E&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;G&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">([</span><span class="s">&#39;J&#39;</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">],</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="limit-the-length-of-detected-tokens">
<h3><a class="toc-backref" href="#id8">Limit the length of detected tokens</a><a class="headerlink" href="#limit-the-length-of-detected-tokens" title="Permalink to this headline">¶</a></h3>
<p>Imagine that you just want to detect and recognize a small part of a long
acoustic event (e.g. engine noise, water flow, etc.) and avoid that that
event hogs the tokenizer and prevent it from feeding the event to the next
processing step (i.e. a sound recognizer). You can do this by:</p>
<blockquote>
<div><ul class="simple">
<li>limiting the length of a detected token.</li>
</ul>
<p>and</p>
<ul class="simple">
<li>using a callback function as an argument to <a class="reference internal" href="core.html#auditok.core.StreamTokenizer.tokenize" title="auditok.core.StreamTokenizer.tokenize"><tt class="xref py py-class docutils literal"><span class="pre">auditok.core.StreamTokenizer.tokenize</span></tt></a>
so that the tokenizer delivers a token as soon as it is detected.</li>
</ul>
</div></blockquote>
<p>The following code limits the length of a token to 5:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">StringDataSource</span><span class="p">,</span> <span class="n">DataValidator</span>

<span class="k">class</span> <span class="nc">UpperCaseChecker</span><span class="p">(</span><span class="n">DataValidator</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>

<span class="n">dsource</span> <span class="o">=</span> <span class="n">StringDataSource</span><span class="p">(</span><span class="s">&quot;aaaABCDEFGHIJKbbb&quot;</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">UpperCaseChecker</span><span class="p">(),</span>
             <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_token</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;token = &#39;{0}&#39;, starts at {1}, ends at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>

<span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">dsource</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">print_token</span><span class="p">)</span>
</pre></div>
</div>
<p>output:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="s">&quot;token = &#39;ABCDE&#39;, starts at 3, ends at 7&quot;</span>
<span class="s">&quot;token = &#39;FGHIJ&#39;, starts at 8, ends at 12&quot;</span>
<span class="s">&quot;token = &#39;K&#39;, starts at 13, ends at 13&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="auditok-and-audio-data">
<h2><a class="toc-backref" href="#id9"><cite>auditok</cite> and Audio Data</a><a class="headerlink" href="#auditok-and-audio-data" title="Permalink to this headline">¶</a></h2>
<p>In the rest of this document we will use <a class="reference internal" href="util.html#auditok.util.ADSFactory" title="auditok.util.ADSFactory"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory</span></tt></a>, <a class="reference internal" href="util.html#auditok.util.AudioEnergyValidator" title="auditok.util.AudioEnergyValidator"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.AudioEnergyValidator</span></tt></a>
and <a class="reference internal" href="core.html#auditok.core.StreamTokenizer" title="auditok.core.StreamTokenizer"><tt class="xref py py-class docutils literal"><span class="pre">auditok.core.StreamTokenizer</span></tt></a> for Audio Activity Detection demos using audio data. Before we get any
further it is worth, explaining a certain number of points.</p>
<p><a class="reference internal" href="util.html#auditok.util.ADSFactory.ads" title="auditok.util.ADSFactory.ads"><tt class="xref py py-func docutils literal"><span class="pre">auditok.util.ADSFactory.ads()</span></tt></a> method is used to create an <a class="reference internal" href="util.html#auditok.util.ADSFactory.AudioDataSource" title="auditok.util.ADSFactory.AudioDataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory.AudioDataSource</span></tt></a>
object either from a wave file, the built-in microphone or a user-supplied data buffer. Refer to the API reference
for more information and examples on <tt class="xref py py-func docutils literal"><span class="pre">ADSFactory.ads()</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">AudioDataSource</span></tt>.</p>
<p>The created <tt class="xref py py-class docutils literal"><span class="pre">AudioDataSource</span></tt> object is then passed to <tt class="xref py py-func docutils literal"><span class="pre">StreamTokenizer.tokenize()</span></tt> for tokenization.</p>
<p><a class="reference internal" href="util.html#auditok.util.ADSFactory.ads" title="auditok.util.ADSFactory.ads"><tt class="xref py py-func docutils literal"><span class="pre">auditok.util.ADSFactory.ads()</span></tt></a> accepts a number of keyword arguments, of which none is mandatory.
The returned <tt class="xref py py-class docutils literal"><span class="pre">AudioDataSource</span></tt> object&#8217;s features and behavior can however greatly differ
depending on the passed arguments. Further details can be found in the respective method documentation.</p>
<p>Note however the following two calls that will create an <tt class="xref py py-class docutils literal"><span class="pre">AudioDataSource</span></tt>
that reads data from an audio file and from the built-in microphone respectively.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">ADSFactory</span>

<span class="c"># Get an AudioDataSource from a file</span>
<span class="c"># use &#39;filename&#39;, alias &#39;fn&#39; keyword argument</span>
<span class="n">file_ads</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;path/to/file/&quot;</span><span class="p">)</span>

<span class="c"># Get an AudioDataSource from the built-in microphone</span>
<span class="c"># The returned object has the default values for sampling</span>
<span class="c"># rate, sample width an number of channels. see method&#39;s</span>
<span class="c"># documentation for customized values</span>
<span class="n">mic_ads</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">()</span>
</pre></div>
</div>
<p>For <tt class="xref py py-class docutils literal"><span class="pre">StreamTkenizer</span></tt>, parameters <cite>min_length</cite>, <cite>max_length</cite> and <cite>max_continuous_silence</cite>
are expressed in terms of number of frames. Each call to <tt class="xref py py-func docutils literal"><span class="pre">AudioDataSource.read()</span></tt> returns
one frame of data or None.</p>
<p>If you want a <cite>max_length</cite> of 2 seconds for your detected sound events and your <em>analysis window</em>
is <em>10 ms</em> long, you have to specify a <cite>max_length</cite> of 200 (<cite>int(2. / (10. / 1000)) == 200</cite>).
For a <cite>max_continuous_silence</cite> of <em>300 ms</em> for instance, the value to pass to StreamTokenizer is 30
(<cite>int(0.3 / (10. / 1000)) == 30</cite>).</p>
<p>Each time <tt class="xref py py-class docutils literal"><span class="pre">StreamTkenizer</span></tt> calls the <tt class="xref py py-func docutils literal"><span class="pre">read()</span></tt> (has no argument) method of an
<tt class="xref py py-class docutils literal"><span class="pre">AudioDataSource</span></tt> object, it returns the same amount of data, except if there are no more
data (returns what&#8217;s left in stream or None).</p>
<p>This fixed-length amount of data is referred here to as <strong>analysis window</strong> and is a parameter of
<tt class="xref py py-func docutils literal"><span class="pre">ADSFactory.ads()</span></tt> method. By default <tt class="xref py py-func docutils literal"><span class="pre">ADSFactory.ads()</span></tt> uses an analysis window of 10 ms.</p>
<p>The number of samples that 10 ms of audio data contain will vary, depending on the sampling
rate of your audio source/data (file, microphone, etc.).
For a sampling rate of 16KHz (16000 samples per second), we have 160 samples for 10 ms.</p>
<p>You can use the <cite>block_size</cite> keyword (alias <cite>bs</cite>) to define your analysis window:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">ADSFactory</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Assume you have an audio file with a sampling rate of 16000</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c"># file_ads.read() will return blocks of 160 sample</span>
<span class="n">file_ads</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;path/to/file/&quot;</span><span class="p">,</span> <span class="n">block_size</span> <span class="o">=</span> <span class="mi">160</span><span class="p">)</span>

<span class="c"># file_ads.read() will return blocks of 320 sample</span>
<span class="n">file_ads</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;path/to/file/&quot;</span><span class="p">,</span> <span class="n">bs</span> <span class="o">=</span> <span class="mi">320</span><span class="p">)</span>
</pre></div>
</div>
<p>Fortunately, you can specify the size of your analysis window in seconds, thanks to keyword <cite>block_dur</cite>
(alias <cite>bd</cite>):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">ADSFactory</span>
<span class="c"># use an analysis window of 20 ms</span>
<span class="n">file_ads</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;path/to/file/&quot;</span><span class="p">,</span> <span class="n">bd</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
<p>For <tt class="xref py py-class docutils literal"><span class="pre">StreamTkenizer</span></tt>, each <tt class="xref py py-func docutils literal"><span class="pre">read()</span></tt> call that does not return <cite>None</cite> is treated as a processing
frame. <tt class="xref py py-class docutils literal"><span class="pre">StreamTkenizer</span></tt> has no way to figure out the temporal length of that frame (why sould it?). So to
correctly initialize your <tt class="xref py py-class docutils literal"><span class="pre">StreamTokenizer</span></tt>, based on your analysis window duration, use something like:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">analysis_win_seconds</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c"># 10 ms</span>
<span class="n">my_ads</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">block_dur</span> <span class="o">=</span> <span class="n">analysis_win_seconds</span><span class="p">)</span>
<span class="n">analysis_window_ms</span> <span class="o">=</span> <span class="n">analysis_win_seconds</span> <span class="o">*</span> <span class="mi">1000</span>

<span class="c"># If you want your maximum continuous silence to be 300 ms use:</span>
<span class="n">max_continuous_silence</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">300.</span> <span class="o">/</span> <span class="n">analysis_window_ms</span><span class="p">)</span>

<span class="c"># which is the same as:</span>
<span class="n">max_continuous_silence</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">/</span> <span class="p">(</span><span class="n">analysis_window_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>

<span class="c"># or simply:</span>
<span class="n">max_continuous_silence</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
</div>
<div class="section" id="examples-using-real-audio-data">
<h2><a class="toc-backref" href="#id10">Examples using real audio data</a><a class="headerlink" href="#examples-using-real-audio-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="extract-isolated-phrases-from-an-utterance">
<h3><a class="toc-backref" href="#id11">Extract isolated phrases from an utterance</a><a class="headerlink" href="#extract-isolated-phrases-from-an-utterance" title="Permalink to this headline">¶</a></h3>
<p>We will build an <a class="reference internal" href="util.html#auditok.util.ADSFactory.AudioDataSource" title="auditok.util.ADSFactory.AudioDataSource"><tt class="xref py py-class docutils literal"><span class="pre">auditok.util.ADSFactory.AudioDataSource</span></tt></a> using a wave file from
the database. The file contains of isolated pronunciation of digits from 1 to 1
in Arabic as well as breath-in/out between 2 and 3. The code will play the
original file then the detected sounds separately. Note that we use an
<cite>energy_threshold</cite> of 65, this parameter should be carefully chosen. It depends
on microphone quality, background noise and the amplitude of events you want to
detect.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">ADSFactory</span><span class="p">,</span> <span class="n">AudioEnergyValidator</span><span class="p">,</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">player_for</span><span class="p">,</span> <span class="n">dataset</span>

<span class="c"># We set the `record` argument to True so that we can rewind the source</span>
<span class="n">asource</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">one_to_six_arabic_16000_mono_bc_noise</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">validator</span> <span class="o">=</span> <span class="n">AudioEnergyValidator</span><span class="p">(</span><span class="n">sample_width</span><span class="o">=</span><span class="n">asource</span><span class="o">.</span><span class="n">get_sample_width</span><span class="p">(),</span> <span class="n">energy_threshold</span><span class="o">=</span><span class="mi">65</span><span class="p">)</span>

<span class="c"># Defalut analysis window is 10 ms (float(asource.get_block_size()) / asource.get_sampling_rate())</span>
<span class="c"># min_length=20 : minimum length of a valid audio activity is 20 * 10 == 200 ms</span>
<span class="c"># max_length=4000 :  maximum length of a valid audio activity is 400 * 10 == 4000 ms == 4 seconds</span>
<span class="c"># max_continuous_silence=30 : maximum length of a tolerated  silence within a valid audio activity is 30 * 30 == 300 ms</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">asource</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">asource</span><span class="p">)</span>

<span class="c"># Play detected regions back</span>

<span class="n">player</span> <span class="o">=</span> <span class="n">player_for</span><span class="p">(</span><span class="n">asource</span><span class="p">)</span>

<span class="c"># Rewind and read the whole signal</span>
<span class="n">asource</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
<span class="n">original_signal</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
   <span class="n">w</span> <span class="o">=</span> <span class="n">asource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
   <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">break</span>
   <span class="n">original_signal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

<span class="n">original_signal</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_signal</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Playing the original file...&quot;</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">original_signal</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;playing detected regions...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Token starts at {0} and ends at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>
</div>
<p>The tokenizer extracts 8 audio regions from the signal, including all isolated digits
(from 1 to 6) as well as the 2-phase respiration of the subject. You might have noticed
that, in the original file, the last three digit are closer to each other than the
previous ones. If you wan them to be extracted as one single phrase, you can do so
by tolerating a larger continuous silence within a detection:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">tokenizer</span><span class="o">.</span><span class="n">max_continuous_silence</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">asource</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">asource</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
   <span class="k">print</span><span class="p">(</span><span class="s">&quot;Token starts at {0} and ends at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
   <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
</pre></div>
</div>
</div>
<div class="section" id="trim-leading-and-trailing-silence">
<h3><a class="toc-backref" href="#id12">Trim leading and trailing silence</a><a class="headerlink" href="#trim-leading-and-trailing-silence" title="Permalink to this headline">¶</a></h3>
<p>The  tokenizer in the following example is set up to remove the silence
that precedes the first acoustic activity or follows the last activity
in a record. It preserves whatever it founds between the two activities.
In other words, it removes the leading and trailing silence.</p>
<p>Sampling rate is 44100 sample per second, we&#8217;ll use an analysis window of 100 ms
(i.e. block_size == 4410)</p>
<p>Energy threshold is 50.</p>
<p>The tokenizer will start accumulating windows up from the moment it encounters
the first analysis window of an energy &gt;= 50. ALL the following windows will be
kept regardless of their energy. At the end of the analysis, it will drop trailing
windows with an energy below 50.</p>
<p>This is an interesting example because the audio file we&#8217;re analyzing contains a very
brief noise that occurs within the leading silence. We certainly do want our tokenizer
to stop at this point and considers whatever it comes after as a useful signal.
To force the tokenizer to ignore that brief event we use two other parameters <cite>init_min</cite>
ans <cite>init_max_silence</cite>. By <cite>init_min</cite> = 3 and <cite>init_max_silence</cite> = 1 we tell the tokenizer
that a valid event must start with at least 3 noisy windows, between which there
is at most 1 silent window.</p>
<p>Still with this configuration we can get the tokenizer detect that noise as a valid event
(if it actually contains 3 consecutive noisy frames). To circumvent this we use an enough
large analysis window (here of 100 ms) to ensure that the brief noise be surrounded by a much
longer silence and hence the energy of the overall analysis window will be below 50.</p>
<p>When using a shorter analysis window (of 10 ms for instance, block_size == 441), the brief
noise contributes more to energy calculation which yields an energy of over 50 for the window.
Again we can deal with this situation by using a higher energy threshold (55 for example).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">ADSFactory</span><span class="p">,</span> <span class="n">AudioEnergyValidator</span><span class="p">,</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">player_for</span><span class="p">,</span> <span class="n">dataset</span>

<span class="c"># record = True so that we&#39;ll be able to rewind the source.</span>
<span class="n">asource</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">was_der_mensch_saet_mono_44100_lead_trail_silence</span><span class="p">,</span>
         <span class="n">record</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">4410</span><span class="p">)</span>
<span class="n">asource</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

<span class="n">original_signal</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># Read the whole signal</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
   <span class="n">w</span> <span class="o">=</span> <span class="n">asource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
   <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">break</span>
   <span class="n">original_signal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

<span class="n">original_signal</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_signal</span><span class="p">)</span>

<span class="c"># rewind source</span>
<span class="n">asource</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>

<span class="c"># Create a validator with an energy threshold of 50</span>
<span class="n">validator</span> <span class="o">=</span> <span class="n">AudioEnergyValidator</span><span class="p">(</span><span class="n">sample_width</span><span class="o">=</span><span class="n">asource</span><span class="o">.</span><span class="n">get_sample_width</span><span class="p">(),</span> <span class="n">energy_threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c"># Create a tokenizer with an unlimited token length and continuous silence within a token</span>
<span class="c"># Note the DROP_TRAILING_SILENCE mode that will ensure removing trailing silence</span>
<span class="n">trimmer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">min_length</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">99999999</span><span class="p">,</span> <span class="n">init_min</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">init_max_silence</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">9999999</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">StreamTokenizer</span><span class="o">.</span><span class="n">DROP_TRAILING_SILENCE</span><span class="p">)</span>

<span class="n">tokens</span> <span class="o">=</span> <span class="n">trimmer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">asource</span><span class="p">)</span>

<span class="c"># Make sure we only have one token</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Should have detected one single token&quot;</span>

<span class="n">trimmed_signal</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

<span class="n">player</span> <span class="o">=</span> <span class="n">player_for</span><span class="p">(</span><span class="n">asource</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Playing original signal (with leading and trailing silence)...&quot;</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">original_signal</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Playing trimmed signal...&quot;</span><span class="p">)</span>
<span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">trimmed_signal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="online-audio-signal-processing">
<h3><a class="toc-backref" href="#id13">Online audio signal processing</a><a class="headerlink" href="#online-audio-signal-processing" title="Permalink to this headline">¶</a></h3>
<p>In the next example, audio data is directly acquired from the built-in microphone.
The <a class="reference internal" href="core.html#auditok.core.StreamTokenizer.tokenize" title="auditok.core.StreamTokenizer.tokenize"><tt class="xref py py-func docutils literal"><span class="pre">auditok.core.StreamTokenizer.tokenize()</span></tt></a> method is passed a callback function
so that audio activities are delivered as soon as they are detected. Each detected
activity is played back using the build-in audio output device.</p>
<p>As mentioned before , Signal energy is strongly related to many factors such
microphone sensitivity, background noise (including noise inherent to the hardware),
distance and your operating system sound settings. Try a lower <cite>energy_threshold</cite>
if your noise does not seem to be detected and a higher threshold if you notice
an over detection (echo method prints a detection where you have made no noise).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">auditok</span> <span class="kn">import</span> <span class="n">ADSFactory</span><span class="p">,</span> <span class="n">AudioEnergyValidator</span><span class="p">,</span> <span class="n">StreamTokenizer</span><span class="p">,</span> <span class="n">player_for</span>

<span class="c"># record = True so that we&#39;ll be able to rewind the source.</span>
<span class="c"># max_time = 10: read 10 seconds from the microphone</span>
<span class="n">asource</span> <span class="o">=</span> <span class="n">ADSFactory</span><span class="o">.</span><span class="n">ads</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">validator</span> <span class="o">=</span> <span class="n">AudioEnergyValidator</span><span class="p">(</span><span class="n">sample_width</span><span class="o">=</span><span class="n">asource</span><span class="o">.</span><span class="n">get_sample_width</span><span class="p">(),</span> <span class="n">energy_threshold</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">StreamTokenizer</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">max_continuous_silence</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">player</span> <span class="o">=</span> <span class="n">player_for</span><span class="p">(</span><span class="n">asource</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
   <span class="k">print</span><span class="p">(</span><span class="s">&quot;Acoustic activity at: {0}--{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
   <span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="n">asource</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

<span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">asource</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">echo</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to re-run the tokenizer after changing of one or many parameters, use the following code:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">asource</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
<span class="c"># change energy threshold for example</span>
<span class="n">tokenizer</span><span class="o">.</span><span class="n">validator</span><span class="o">.</span><span class="n">set_energy_threshold</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
<span class="n">tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">asource</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">echo</span><span class="p">)</span>
</pre></div>
</div>
<p>In case you want to play the whole recorded signal back use:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">asource</span><span class="o">.</span><span class="n">get_audio_source</span><span class="p">()</span><span class="o">.</span><span class="n">get_data_buffer</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="contributing">
<h2><a class="toc-backref" href="#id14">Contributing</a><a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p><strong>auditok</strong> is on <a class="reference external" href="https://github.com/amsehili/auditok">GitHub</a>. You&#8217;re welcome to fork it and contribute.</p>
<p>Amine SEHILI &lt;<a class="reference external" href="mailto:amine&#46;sehili&#37;&#52;&#48;gmail&#46;com">amine<span>&#46;</span>sehili<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;
September 2015</p>
</div>
<div class="section" id="license">
<h2><a class="toc-backref" href="#id15">License</a><a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>This package is published under GNU GPL Version 3.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="core.html" class="btn btn-neutral float-right" title="auditok.core" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cmdline.html" class="btn btn-neutral" title="auditok Command-line Usage Guide" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Amine Sehili.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>