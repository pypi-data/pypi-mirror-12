(function(){var e,i,t,l=function(e,i){return function(){return e.apply(i,arguments)}};e=function(){function e(){return["ui.router","ui.bootstrap","common","ngAnimate","guanlecoja.ui"]}return e}(),t=function(){function e(e,i){var t,l,n;l="console",i.addGroup({name:l,caption:"Console View",icon:"exclamation-circle",order:5}),t={group:l,caption:"Console View"},n={controller:""+l+"Controller",controllerAs:"c",templateUrl:"console_view/views/"+l+".html",name:l,url:"/"+l,data:t},e.state(n)}return e}(),i=function(){function e(e,i,t,n){var o,r,c,s,a;this.$scope=e,this.buildbotService=n,this.matchBuildWithChange=l(this.matchBuildWithChange,this),c=this.buildbotService.all("builds").bind(this.$scope),o=this.buildbotService.all("builders").bind(this.$scope),a=this.buildbotService.all("changes").bind(this.$scope),r=this.buildbotService.all("buildrequests").bind(this.$scope),s=this.buildbotService.all("buildsets").bind(this.$scope),this.loading=!0,i.all([c,o,a,r,s]).then(function(i){return function(l){var n,o,r,c,s,a,d,u,h,g,f,p;for(i.builds=l[0],i.builders=l[1],i.changes=l[2],i.buildrequests=l[3],i.buildsets=l[4],i.loading=!1,g=i.changes,c=0,d=g.length;d>c;c++)for(r=g[c],r.builds=[],f=i.builders,s=0,u=f.length;u>s;s++)o=f[s],r.builds[o.builderid-1]={builderid:o.builderid};for(p=i.builds,a=0,h=p.length;h>a;a++)n=p[a],i.matchBuildWithChange(n);return i.setWidth(t.innerWidth),angular.element(t).bind("resize",function(){return i.setWidth(t.innerWidth),e.$apply()})}}(this))}return e.prototype.matchBuildWithChange=function(e){var i,t,l,n,o,r,c,s;if(i=this.buildrequests[e.buildrequestid-1],t=this.buildsets[i.buildsetid-1],null!=i&&null!=t&&null!=t.sourcestamps){for(c=t.sourcestamps,s=[],o=0,r=c.length;r>o;o++)n=c[o],s.push(function(){var i,t,o,r;for(o=this.changes,r=[],i=0,t=o.length;t>i;i++)l=o[i],l.sourcestamp.ssid===n.ssid?r.push(l.builds[e.builderid-1]=e):r.push(void 0);return r}.call(this));return s}},e.prototype.setWidth=function(e){return this.cellWidth=""+100/this.builders.length+"%",this.width=.85*e/this.builders.length>40?"100%":""+40*this.builders.length/.85+"px"},e.prototype.openAll=function(){return this.$scope.$broadcast("showAllInfo",!1)},e.prototype.closeAll=function(){return this.$scope.$broadcast("showAllInfo",!0)},e}(),angular.module("console_view",new e).config(["$stateProvider","glMenuServiceProvider",t]).controller("consoleController",["$scope","$q","$window","buildbotService",i])}).call(this),function(){var e,i;e=function(){function e(){return{replace:!0,restrict:"EA",scope:{width:"=",cellWidth:"=",builders:"="},templateUrl:"console_view/views/buildersheader.html",controller:"_buildersHeaderController",controllerAs:"bh"}}return e}(),i=function(){function e(e){e.$watch("width",function(e){return function(i){e.width=i}}(this)),e.$watch("cellWidth",function(e){return function(i){e.cellWidth=i}}(this)),e.$watchCollection("builders",function(e){return function(i){e.builders=i}}(this))}return e}(),angular.module("console_view").directive("buildersHeader",[e]).controller("_buildersHeaderController",["$scope",i])}.call(this),function(){var e,i;e=function(){function e(){return{replace:!1,restrict:"EA",scope:{width:"=",cellWidth:"=",change:"="},templateUrl:"console_view/views/changerow.html",controller:"_changeRowController",controllerAs:"cr"}}return e}(),i=function(){function e(e,i,t){this.$modal=t,angular.extend(this,i),this.infoIsCollapsed=!0,e.$on("showAllInfo",function(e){return function(i,t){return e.infoIsCollapsed=t}}(this)),e.$watch("width",function(e){return function(i){e.width=i}}(this)),e.$watch("cellWidth",function(e){return function(i){e.cellWidth=i}}(this)),e.$watch("change",function(e){return function(i){return e.change=i,e.change&&(angular.isString(e.change.author)&&e.formatAuthor(),angular.isString(e.change.repository))?e.createLink():void 0}}(this))}return e.prototype.formatAuthor=function(){var e,i;return i=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/,e=i.exec(this.change.author),e&&this.change.author.split(" ").length>0?(this.change.author=this.change.author.replace(RegExp("\\s<"+e[0]+">"),""),this.change.email=e[0]):void 0},e.prototype.createLink=function(){var e;return e=this.change.repository.replace(".git",""),this.change.link=""+e+"/commit/"+this.change.revision},e.prototype.selectBuild=function(e){var i;return i=this.$modal.open({templateUrl:"console_view/views/modal.html",controller:"consoleModalController as modal",windowClass:"modal-small",resolve:{selectedBuild:function(){return e}}})},e.prototype.createFileLink=function(e){var i;return i=this.change.repository.replace(".git",""),""+i+"/blob/"+this.change.revision+"/"+e},e.prototype.toggleInfo=function(){return this.infoIsCollapsed=!this.infoIsCollapsed},e}(),angular.module("console_view").directive("changeRow",[e]).controller("_changeRowController",["$scope","resultsService","$modal",i])}.call(this),function(){var e;e=function(){function e(e,i,t){this.$modalInstance=i,this.selectedBuild=t,e.$on("$stateChangeStart",function(e){return function(){return e.close()}}(this))}return e.prototype.close=function(){return this.$modalInstance.close()},e}(),angular.module("console_view").controller("consoleModalController",["$scope","$modalInstance","selectedBuild",e])}.call(this),angular.module("console_view").run(["$templateCache",function(e){e.put("console_view/views/console.html",'<div class="console"><div ng-show="c.loading" class="load-indicator"><div class="spinner"><i class="fa fa-circle-o-notch fa-spin fa-2x"></i><p>loading</p></div></div><div class="header"><div ng-style="{width: c.width}" class="header-content"><div class="col-15"><div class="buttons"><i ng-click="c.openAll()" tooltip="Open information for all changes" tooltip-placement="right" class="fa fa-plus-circle"></i><i ng-click="c.closeAll()" tooltip="Close information for all changes" tooltip-placement="right" class="fa fa-minus-circle"></i></div><div class="search-field"><input type="text" name="search" ng-model="search" placeholder="search"/></div></div><div class="col-85"><builders-header builders="c.builders" width="c.width" cell-width="c.cellWidth"></builders-header></div></div></div><div class="content"><div ng-style="{width: c.width}" class="change-rows"><change-row ng-repeat="change in c.changes | filter: search | orderBy: \'changeid\':true track by change.changeid" change="change" width="c.width" cell-width="c.cellWidth"></change-row></div></div></div>'),e.put("console_view/views/buildersheader.html",'<div class="builders"><a ng-repeat="builder in bh.builders | orderBy: \'builderid\' track by builder.builderid" ng-style="{width: bh.cellWidth}" ng-href="#/builders/{{ builder.builderid }}" ng-bind="builder.name" class="builder"></a></div>'),e.put("console_view/views/changerow.html",'<div class="change-row"><div class="col-15"><div class="name"><i ng-click="cr.toggleInfo()" ng-class="{\'fa-rotate-180\': !cr.infoIsCollapsed}" class="fa fa-chevron-circle-down"></i>{{ cr.change.changeid }}.<span tooltip="{{ cr.change.comments }}" tooltip-placement="top"><a ng-if="cr.change.email" ng-href="mailto: {{cr.change.email}}" target="_blank"> {{ cr.change.author }}</a><span ng-if="!cr.change.email"> {{ cr.change.author }}</span></span></div></div><div class="col-85"><div class="builds"><a ng-repeat="build in cr.change.builds | orderBy:\'builderid\'" ng-style="{\'width\': cr.cellWidth}" class="build"><div ng-if="build.buildid" ng-class="cr.results2class(build, \'pulse\')" ng-click="cr.selectBuild(build)" class="badge-status">{{ build.number }}</div></a></div></div><div ng-hide="cr.infoIsCollapsed" class="col info-collapse"><!-- Comment--><div class="info"><i class="fa fa-comment-o"></i><p>{{ cr.change.comments }}</p></div><!-- Link to the change--><div class="info"><i class="fa fa-link"></i><p><a ng-href="{{ cr.change.link }}" target="_blank">{{ cr.change.revision | limitTo: 10 }}</a></p></div><!-- Changed files--><div class="info"><i class="fa fa-file-o"></i><p ng-repeat="file in cr.change.files"><a ng-href="{{ cr.createFileLink(file) }}" target="_blank">{{ file }}</a></p></div></div></div>'),e.put("console_view/views/modal.html",'<!-- Show build summary for the selected build in a modal window--><div class="modal-header"><i ng-click="modal.close()" class="fa fa-times pull-right"></i><h4 class="modal-title">Build summary</h4></div><div class="modal-body"><buildsummary ng-if="modal.selectedBuild" buildid="modal.selectedBuild.buildid"></buildsummary></div>')}]);