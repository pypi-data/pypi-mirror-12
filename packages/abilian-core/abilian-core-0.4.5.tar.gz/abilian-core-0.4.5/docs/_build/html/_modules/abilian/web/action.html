

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>abilian.web.action &mdash; Abilian 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Abilian 0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Abilian
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">About Abilian Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installing.html">Installing Abilian Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Constributing to Abilian Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../coding-standard.html">Coding standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog for Abilian Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../credits.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Abilian</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>abilian.web.action</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for abilian.web.action</h1><div class="highlight"><pre>
<span class="c"># coding=utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span><span class="p">,</span> <span class="n">Markup</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span><span class="p">,</span> <span class="n">g</span>
<span class="kn">from</span> <span class="nn">flask.signals</span> <span class="kn">import</span> <span class="n">appcontext_pushed</span>

<span class="kn">from</span> <span class="nn">abilian.web.util</span> <span class="kn">import</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">abilian.core.singleton</span> <span class="kn">import</span> <span class="n">UniqueName</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Action&#39;</span><span class="p">,</span> <span class="s">&#39;ModalActionMixin&#39;</span><span class="p">,</span> <span class="s">&#39;actions&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Status</span><span class="p">(</span><span class="n">UniqueName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Action UI status names</span>
<span class="sd">  &quot;&quot;&quot;</span>


<span class="c">#: default action status: show in UID, usable, not marked &quot;current&quot;</span>
<span class="n">ENABLED</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="s">u&#39;enabled&#39;</span><span class="p">)</span>
<span class="c">#: action is &quot;active&quot; or &quot;current&quot;. For example the current navigation item.</span>
<span class="n">ACTIVE</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="s">u&#39;active&#39;</span><span class="p">)</span>
<span class="c">#: action should be shown in a disabled state</span>
<span class="n">DISABLED</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="s">u&#39;disabled&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getset</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Shortcut for a custom getter/ standard setter.</span>

<span class="sd">  Usage::</span>
<span class="sd">      @getset</span>
<span class="sd">      def my_property(self, value=None):</span>
<span class="sd">          if value is None:</span>
<span class="sd">              return getter_value</span>
<span class="sd">          set_value(value)</span>

<span class="sd">  Default value for `value` should be any marker that helps distinguish</span>
<span class="sd">  between getter or setter mode. If None is not appropriate a good approach is</span>
<span class="sd">  to use a unique object instance::</span>

<span class="sd">      MARK = object()</span>
<span class="sd">      # test like this</span>
<span class="sd">      if value is MARK:</span>
<span class="sd">        # getter mode</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Icon</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Base abstract class for icons</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__html__</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">NamedIconBase</span><span class="p">(</span><span class="n">Icon</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Renders markup for named icons set</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">template</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

  <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Glyphicon</span><span class="p">(</span><span class="n">NamedIconBase</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Renders markup for bootstrap&#39;s glyphicons</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">u&#39;&lt;i class=&quot;glyphicon glyphicon-{{ name }}&quot;&gt;&lt;/i&gt;&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FAIcon</span><span class="p">(</span><span class="n">NamedIconBase</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Renders markup for FontAwesome icons</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">u&#39;&lt;i class=&quot;fa fa-{{ name }}&quot;&gt;&lt;/i&gt;&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DynamicIcon</span><span class="p">(</span><span class="n">Icon</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">u&#39;&lt;img {</span><span class="si">%- i</span><span class="s">f css %} class=&quot;{{ css }}&quot;{</span><span class="si">% e</span><span class="s">ndif %} &#39;</span>
                      <span class="s">u&#39;src=&quot;{{ url }}&quot; &#39;</span>
                      <span class="s">u&#39;width=&quot;{{ width }}&quot; height=&quot;{{ height }}&quot; /&gt;&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="s">u&#39;&#39;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">url_args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fixed_url_args</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">css</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fixed_url_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fixed_url_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fixed_url_args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">url_args_callback</span> <span class="o">=</span> <span class="n">url_args</span>

    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>

  <span class="k">def</span> <span class="nf">get_url_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_url_args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kw</span>

  <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
      <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span><span class="p">()</span>

    <span class="n">url_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_args_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">url_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_args_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_args</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
      <span class="n">url</span><span class="o">=</span><span class="n">url_for</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">url_args</span><span class="p">),</span>
      <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
      <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
      <span class="n">css</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">StaticIcon</span><span class="p">(</span><span class="n">DynamicIcon</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Renders markup for icon located in static folder served by `endpoint`.</span>

<span class="sd">  Default endpoint is application static folder.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="s">u&#39;&#39;</span><span class="p">,</span>
               <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">DynamicIcon</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">css</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
                         <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Endpoint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="c"># FIXME: *args doesn&#39;t seem to be relevant.</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

  <span class="k">def</span> <span class="nf">get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hook for subclasses.</span>

<span class="sd">    The key and values in the returned dictionnary can be safely changed</span>
<span class="sd">    without side effects on self.kwargs (provided you don&#39;t alter</span>
<span class="sd">    mutable values, like calling list.pop()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_kwargs</span><span class="p">()))</span>

  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;{cls}({name!r}, *{args!r}, **{kwargs!r})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
      <span class="n">cls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
      <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
      <span class="n">args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
      <span class="n">kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>


<div class="viewcode-block" id="Action"><a class="viewcode-back" href="../../../api.html#abilian.web.action.Action">[docs]</a><span class="k">class</span> <span class="nc">Action</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Action interface.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">Endpoint</span> <span class="o">=</span> <span class="n">Endpoint</span>
  <span class="n">category</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">description</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">icon</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">_url</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">CSS_CLASS</span> <span class="o">=</span> <span class="s">u&#39;action action-{category} action-{category}-{name}&#39;</span>

  <span class="c">#: A :class:`Endpoint` instance, a string for a simple endpoint, a tuple</span>
  <span class="c">#: ``(endpoint_name, kwargs)``  or a callable which accept a : context dict</span>
  <span class="c">#: and returns one of those a valid values.</span>
  <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="c">#: A boolean (or something that can be converted to boolean), or a callable</span>
  <span class="c">#: which accepts a context dict as parameter. See :meth:`available`.</span>
  <span class="n">condition</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="n">template_string</span> <span class="o">=</span> <span class="p">(</span>
      <span class="s">u&#39;&lt;a class=&quot;{{ action.css_class }}&quot; href=&quot;{{ url }}&quot;&gt;&#39;</span>
      <span class="s">u&#39;{</span><span class="si">%- i</span><span class="s">f action.icon %}{{ action.icon }} {</span><span class="si">% e</span><span class="s">ndif %}&#39;</span>
      <span class="s">u&#39;{{ action.title }}&#39;</span>
      <span class="s">u&#39;&lt;/a&gt;&#39;</span>
  <span class="p">)</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">template</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">template_string</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">button</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param button: if not `None`, a valid `btn` class (i.e `default`,</span>
<span class="sd">    `primary`...)</span>

<span class="sd">    :param css: additional css class string</span>

<span class="sd">    :param template: optional: a template file name or a list of filenames.</span>

<span class="sd">    :param template_string: template_string to use. Defaults to</span>
<span class="sd">    `Action.template_string`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">if</span> <span class="n">button</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">CSS_CLASS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CSS_CLASS</span> <span class="o">+</span> <span class="s">u&#39; btn btn-{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">css</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">CSS_CLASS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CSS_CLASS</span> <span class="o">+</span> <span class="s">u&#39; &#39;</span> <span class="o">+</span> <span class="n">css</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_css_class</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
      <span class="n">icon</span> <span class="o">=</span> <span class="n">Glyphicon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="n">icon</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">ENABLED</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">Endpoint</span><span class="p">):</span>
      <span class="c"># property getter will make it and Endpoint instance</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
    <span class="k">if</span> <span class="n">template_string</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template_string</span> <span class="o">=</span> <span class="n">template_string</span>

  <span class="c">#: ui status. A :class:`Status` instance</span>
  <span class="nd">@getset</span>
  <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="c">#: Boolean. Disabled actions are unconditionnaly skipped.</span>
  <span class="nd">@getset</span>
  <span class="k">def</span> <span class="nf">enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="n">enabled</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">enabled</span>

  <span class="k">def</span> <span class="nf">_get_and_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attr</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="n">actions</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_and_call</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>

  <span class="nd">@title.setter</span>
  <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_title</span> <span class="o">=</span> <span class="n">title</span>

  <span class="k">def</span> <span class="nf">_build_css_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">css_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CSS_CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">css_cat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;[^ _a-zA-Z0-9-]&#39;</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">css_cat</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">css_class</span> <span class="o">=</span> <span class="n">css_cat</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_and_call</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">)</span>

  <span class="nd">@description.setter</span>
  <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">description</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_and_call</span><span class="p">(</span><span class="s">&#39;icon&#39;</span><span class="p">)</span>

  <span class="nd">@icon.setter</span>
  <span class="k">def</span> <span class="nf">icon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_and_call</span><span class="p">(</span><span class="s">&#39;endpoint&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">Endpoint</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">endpoint</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Invalid endpoint specifier: &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">endpoint</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">endpoint</span>

  <span class="nd">@endpoint.setter</span>
  <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>

<div class="viewcode-block" id="Action.available"><a class="viewcode-back" href="../../../api.html#abilian.web.action.Action.available">[docs]</a>  <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine if this actions is available in this `context`.</span>

<span class="sd">    :param context: a dict whose content is left to application needs; if</span>
<span class="sd">                    :attr:`.condition` is a callable it receives `context`</span>
<span class="sd">                    in parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_condition</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_condition</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Action.pre_condition"><a class="viewcode-back" href="../../../api.html#abilian.web.action.Action.pre_condition">[docs]</a>  <span class="k">def</span> <span class="nf">pre_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called by :meth:`.available` before checking condition.</span>

<span class="sd">    Subclasses may override it to ease creating actions with repetitive</span>
<span class="sd">    check (for example: actions that apply on a given content type</span>
<span class="sd">    only).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="k">def</span> <span class="nf">_check_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>

<div class="viewcode-block" id="Action.render"><a class="viewcode-back" href="../../../api.html#abilian.web.action.Action.render">[docs]</a>  <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_string</span><span class="p">)</span>

    <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">Template</span><span class="p">):</span>
      <span class="n">template</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">get_or_select_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_render_args</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Markup</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Action.get_render_args"><a class="viewcode-back" href="../../../api.html#abilian.web.action.Action.get_render_args">[docs]</a>  <span class="k">def</span> <span class="nf">get_render_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">actions</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">params</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span>
</div>
<div class="viewcode-block" id="Action.url"><a class="viewcode-back" href="../../../api.html#abilian.web.action.Action.url">[docs]</a>  <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span>
    <span class="k">if</span> <span class="n">endpoint</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

</div></div>
<div class="viewcode-block" id="ModalActionMixin"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ModalActionMixin">[docs]</a><span class="k">class</span> <span class="nc">ModalActionMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">template_string</span> <span class="o">=</span> <span class="p">(</span>
      <span class="s">u&#39;&lt;a class=&quot;{{ action.css_class }}&quot; href=&quot;{{ url }}&quot; data-toggle=&quot;modal&quot;&gt;&#39;</span>
      <span class="s">u&#39;{</span><span class="si">%- i</span><span class="s">f action.icon %}{{ action.icon}} {</span><span class="si">% e</span><span class="s">ndif %}&#39;</span>
      <span class="s">u&#39;{{ action.title }}&#39;</span>
      <span class="s">u&#39;&lt;/a&gt;&#39;</span>
  <span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">ButtonAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
  <span class="n">template_string</span> <span class="o">=</span> <span class="p">(</span>
      <span class="s">u&#39;&lt;button type=&quot;submit&quot; &#39;</span>
      <span class="s">u&#39;class=&quot;btn btn-{{ action.btn_class }} {{ action.css_class}}&quot; &#39;</span>
      <span class="s">u&#39;name=&quot;{{ action.submit_name }}&quot; &#39;</span>
      <span class="s">u&#39;value=&quot;{{ action.name }}&quot;&gt;&#39;</span>
      <span class="s">u&#39;{</span><span class="si">%- i</span><span class="s">f action.icon %}{{ action.icon }} {</span><span class="si">% e</span><span class="s">ndif %}&#39;</span>
      <span class="s">u&#39;{{ action.title }}&lt;/button&gt;&#39;</span>
  <span class="p">)</span>

  <span class="n">btn_class</span> <span class="o">=</span> <span class="s">&#39;default&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">submit_name</span><span class="o">=</span><span class="s">&quot;__action&quot;</span><span class="p">,</span> <span class="n">btn_class</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span>
               <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">Action</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">submit_name</span> <span class="o">=</span> <span class="n">submit_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">btn_class</span> <span class="o">=</span> <span class="n">btn_class</span>


<span class="k">class</span> <span class="nc">ActionGroup</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  A group of single actions</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">template_string</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">u&#39;&lt;div class=&quot;btn-group&quot; role=&quot;group&quot; aria-label=&quot;{{ action.name}}&quot;&gt;&#39;</span>
    <span class="s">u&#39;{</span><span class="si">%- f</span><span class="s">or entry in action_items %}&#39;</span>
    <span class="s">u&#39;{{ entry.render() }}&#39;</span>
    <span class="s">u&#39;{</span><span class="si">%- e</span><span class="s">ndfor %}&#39;</span>
    <span class="s">u&#39;&lt;/div&gt;&#39;</span>
  <span class="p">)</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ActionGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_render_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ActionGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_render_args</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">params</span><span class="p">[</span><span class="s">&#39;action_items&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">params</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">params</span>


<span class="k">class</span> <span class="nc">ActionDropDown</span><span class="p">(</span><span class="n">ActionGroup</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Renders as a button dropdown</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">template_string</span> <span class="o">=</span> <span class="s">u&#39;&#39;&#39;</span>
<span class="s">  &lt;div class=&quot;btn-group&quot;&gt;</span>
<span class="s">    &lt;button type=&quot;button&quot; class=&quot;{{ action.css_class }} dropdown-toggle&quot;</span>
<span class="s">            data-toggle=&quot;dropdown&quot; aria-expanded=&quot;false&quot;&gt;</span>
<span class="s">    {</span><span class="si">%- i</span><span class="s">f action.icon %}{{ action.icon }} {</span><span class="si">% e</span><span class="s">ndif %}</span>
<span class="s">    {{ action.title }}</span>
<span class="s">    &lt;span class=&quot;caret&quot;&gt;&lt;/span&gt;</span>
<span class="s">    &lt;/button&gt;</span>
<span class="s">    &lt;ul class=&quot;dropdown-menu&quot; role=&quot;menu&quot;&gt;</span>
<span class="s">    {</span><span class="si">%- f</span><span class="s">or entry in action_items %}</span>
<span class="s">      {</span><span class="si">%- i</span><span class="s">f entry.divider %}&lt;li class=&quot;divider&quot;&gt;&lt;/li&gt;{</span><span class="si">%- e</span><span class="s">ndif %}</span>
<span class="s">      &lt;li&gt;{{ entry.render() }}&lt;/a&gt;</span>
<span class="s">      &lt;/li&gt;</span>
<span class="s">    {</span><span class="si">%- e</span><span class="s">ndfor %}</span>
<span class="s">    &lt;/ul&gt;</span>
<span class="s">  &lt;/div&gt;</span>
<span class="s">  &#39;&#39;&#39;</span>


<span class="k">class</span> <span class="nc">ActionGroupItem</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
  <span class="c">#: if True, add a divider in dropdowns</span>
  <span class="n">divider</span> <span class="o">=</span> <span class="bp">False</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">divider</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ActionGroupItem</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">divider</span> <span class="o">=</span> <span class="n">divider</span>


<div class="viewcode-block" id="ActionRegistry"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ActionRegistry">[docs]</a><span class="k">class</span> <span class="nc">ActionRegistry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; The Action registry.</span>

<span class="sd">  This is a Flask extension which registers :class:`.Action` sets. Actions are</span>
<span class="sd">  grouped by category and are ordered by registering order.</span>

<span class="sd">  From your application use the instanciated registry :data:`.actions`.</span>

<span class="sd">  The registry is available in jinja2 templates as `actions`.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">__EXTENSION_NAME</span> <span class="o">=</span> <span class="s">&#39;abilian:actions&#39;</span>

<div class="viewcode-block" id="ActionRegistry.init_app"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ActionRegistry.init_app">[docs]</a>  <span class="k">def</span> <span class="nf">init_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__EXTENSION_NAME</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span>
      <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;ActionRegistry.init_app: actions already enabled on this application&#39;</span><span class="p">)</span>
      <span class="k">return</span>

    <span class="n">app</span><span class="o">.</span><span class="n">extensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EXTENSION_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span>
    <span class="n">appcontext_pushed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_context</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>

    <span class="nd">@app.context_processor</span>
    <span class="k">def</span> <span class="nf">add_registry_to_jinja_context</span><span class="p">():</span>
      <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionRegistry.installed"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ActionRegistry.installed">[docs]</a>  <span class="k">def</span> <span class="nf">installed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return `True` if the registry has been installed in current applications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">app</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">app</span> <span class="o">=</span> <span class="n">current_app</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__EXTENSION_NAME</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">extensions</span>
</div>
<div class="viewcode-block" id="ActionRegistry.register"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ActionRegistry.register">[docs]</a>  <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">actions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Register `actions` in the current application. All `actions` must be an</span>
<span class="sd">    instance of :class:`.Action` or one of its subclasses.</span>

<span class="sd">    If `overwrite` is `True`, then it is allowed to overwrite an existing</span>
<span class="sd">    action with same name and category; else `ValueError` is raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">installed</span><span class="p">(),</span> <span class="s">&quot;Actions not enabled on this application&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Action</span><span class="p">),</span> <span class="n">actions</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
      <span class="n">cat</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">category</span>
      <span class="n">reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="p">[])</span>
      <span class="n">reg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ActionRegistry.actions"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ActionRegistry.actions">[docs]</a>  <span class="k">def</span> <span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a mapping of category =&gt; actions list.</span>

<span class="sd">    Actions are filtered according to :meth:`.Action.available`.</span>

<span class="sd">    if `context` is None, then current action context is used</span>
<span class="sd">    (:attr:`context`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">installed</span><span class="p">(),</span> <span class="s">&quot;Actions not enabled on this application&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>

    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">actions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="n">result</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">context</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="ActionRegistry.for_category"><a class="viewcode-back" href="../../../api.html#abilian.web.action.ActionRegistry.for_category">[docs]</a>  <span class="k">def</span> <span class="nf">for_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns actions list for this category in current application.</span>

<span class="sd">    Actions are filtered according to :meth:`.Action.available`.</span>

<span class="sd">    if `context` is None, then current action context is used</span>
<span class="sd">    (:attr:`context`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">installed</span><span class="p">(),</span> <span class="s">&quot;Actions not enabled on this application&quot;</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>

    <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">actions</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">current_app</span><span class="o">.</span><span class="n">extensions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__EXTENSION_NAME</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">_init_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">action_context</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return action context (dict type). Applications can modify it to suit</span>
<span class="sd">    their needs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">action_context</span>
</div>
<span class="n">actions</span> <span class="o">=</span> <span class="n">ActionRegistry</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2015, Abilian SAS.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>