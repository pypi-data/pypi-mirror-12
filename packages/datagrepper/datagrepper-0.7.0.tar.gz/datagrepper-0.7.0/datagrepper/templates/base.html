<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="History of the fedmsg bus">
    <meta name="author" content="Ralph Bean">

    <!-- Only allow websockets connections to fedoraproject.org. -->
    <meta http-equiv="Content-Security-Policy" content="connect-src https://*.fedoraproject.org wss://*.fedoraproject.org">

    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.png') }}">


    <title>Datagrepper</title>

    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/raw.css') }}" rel="stylesheet">
    <style type="text/css">
      div {
          white-space:normal;
      }
    </style>
  </head>

  <body>
    <div class="container">

      <div class="page-header row">
        <div class="col-md-6">
          {% if heading %}
          <h1>{{heading}}</h1>
          {% else %}
          <h1>fedmsg <small>messages</small></h1>
          {% endif %}
          <p>See <a href="{{ url_for('index') }}">the documentation</a> for information on how to construct queries.</p>
        </div>
        <div class="col-md-4 col-md-offset-1 hidden">
          <div class="panel panel-default">
            <div class="panel-body text-center">
              <span id="messages-pending"></span> Click to show.
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div id="message-container" class="col-md-12">
          {% include 'raw.html' %}
        </div>
      </div>

      {% if response | length > 1 %}
      <div id="loader" class="row hidden">
        <div class="col-md-4 col-md-offset-4">
          <div class="panel panel-default">
            <div class="panel-body text-center">
                Loading... please wait.
            </div>
          </div>
        </div>
      </div>
      {% endif %}

    <div id="footer">
        <div class="container">
            <p class="text-muted credit">
            Datagrepper is Powered by <a href="http://fedmsg.com">fedmsg</a>. The
            <a href="https://github.com/fedora-infra/datagrepper">source</a>
            and
            <a href="https://github.com/fedora-infra/datagrepper/issues">issue tracker</a>
            are available on github.
            </p>
            <p class="text-muted">
            Running <code>datagrepper-{{grepper_version}}</code>,
            <code>datanommer.models-{{models_version}}</code>
            </p>
        </div>
    </div>
    </div>
    <script src="{{ url_for('static', filename='jquery-2.1.0.min.js') }}"></script>
    {% if autoscroll %}
    <script src="{{ url_for('static', filename='autoscroll.js') }}"></script>
    {% if websocket_address is defined %}
    <script src="{{ url_for('static', filename='live.js') }}"></script>
    <script>
      $(document).ready(function() {
          setup_websocket("{{websocket_address}}");
      });
    </script>
    {% endif %}
    {% endif %}

    {% if fedmenu_url is defined %}
    <script src="{{fedmenu_url}}/js/fedora-libravatar.js"></script>
    <script src="{{fedmenu_url}}/js/fedmenu.js"></script>
    <script>
      fedmenu({
          'url': '{{fedmenu_data_url}}',
          'mimeType': 'application/javascript',
          'position': 'bottom-right',
          {% if arguments is defined %}
            {% if arguments['users'] | length > 0 %}
              'user': "{{arguments['users'][0]}}",
            {% endif %}
            {% if arguments['packages'] | length > 0 %}
              'package': "{{arguments['packages'][0]}}",
            {% endif %}
          {% elif response is defined %}
            {% if response | length == 1 %}
              {% if response[0]['usernames'] | length > 0 %}
                'user': "{{response[0]['usernames'][0]}}",
              {% endif %}
              {% if response[0]['packages'] | length > 0 %}
                'package': "{{response[0]['packages'][0]}}",
              {% endif %}
            {% endif %}
          {% endif %}
      });
    </script>
    {% endif %}


  </body>
</html>
