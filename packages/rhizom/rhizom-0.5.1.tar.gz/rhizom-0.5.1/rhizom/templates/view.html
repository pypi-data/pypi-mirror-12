{% extends "base.html" %}

{% block more_headers %}
<style>
    {% for rtype in rel_types %}
    path.link.{{ rtype.cssname }} {
        stroke: {{ rtype.color }};
    }
    #legend .{{ rtype.cssname }} {
        background-color: {{ rtype.color }};
    }
    {% endfor %}
</style>
{% endblock %}


{% block content %}


<div id="graph-container">

{# Edit panel #}
<div class="edit-panel">
    <div class="edit-panel-content">
        <div class="ajaxloader">
            <img src="{{ url_for("static", filename="ajax-loader-big.gif") }}"
                 alt="Loading..." />
        </div>
        <div class="edit-panel-toolbar">
            <a data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="hover"
               href="" title="{{ _("Help") }}"
               data-content="{{ _("Click on a person to edit their relationships, click on the graph background to add new persons.") }}">
                <span class="glyphicon glyphicon-question-sign"></span>
            </a>
            <a href="" title="{{ _("Close edit panel") }}" class="edit-panel-close">
                <span class="glyphicon glyphicon-remove-circle"></span>
            </a>
        </div>
        <div class="edit-panel-form"
             data-base-url="{{ url_for("edit_all", graph_id=graph.id) }}">
        </div>
    </div>
</div>


{# Graph #}
<div id="graph">
    <div class="ajaxloader">
        <img src="{{ url_for("static", filename="ajax-loader-big.gif") }}"
             alt="Loading..." />
    </div>
</div>

</div>


<div id="graph-footer" class="row">
<div id="legend" class="row">
    <strong>{{ _("Legend:") }}</strong>
    <ul>
        {% for rtype in rel_types %}
        <li><a href="" data-rtype="{{ rtype.cssname }}"
               data-toggle="tooltip" data-placement="top"
               title="{{ _("Hide or show this type") }}">
            <span class="{{ rtype.cssname }}"> </span> {{ rtype.name }}
        </a></li>
        {% endfor %}
    </ul>
</div>
<p>
    <span class="glyphicon glyphicon-user"></span>
    {{ _("%(pnum)s persons, %(rnum)s relationships.", pnum=graph.persons|length, rnum=graph.relationships|length) }}
</p>
<p>
    {{ _("Drag to move, mouse wheel to zoom/unzoom, double click to recenter the view.") }}
</p>
<ul id="graph-actions" class="list-inline">
    <li><strong>{{ _("Actions :") }}</strong></li>
    {% if current_user.has_perm(graph, 'edit') %}
    <li data-toggle="buttons">
        <label class="btn btn-sm btn-info" id="btn-edit-mode">
            <input type="checkbox" autocomplete="off" />
            <span class="glyphicon glyphicon-edit"></span>
            {{ _("Edit mode") }}
        </label>
    </li>
    {% endif %}
    <li><button class="btn btn-sm btn-default" id="btn-stop">
        <span class="glyphicon glyphicon-pause"></span>
        {{ _("Freeze") }}</button>
    </li>
    <li data-toggle="buttons">
        <label class="btn btn-sm btn-default" id="btn-anonymous">
            <input type="checkbox" autocomplete="off" />
            <span class="glyphicon glyphicon-eye-close"></span>
            <span class="glyphicon glyphicon-eye-open"></span>
            {{ _("Anonymous") }}
        </label>
    </li>
    <!-- <button onclick="graph.redraw();">{{ _("Redraw") }}</button> -->
    <li>
        <form action="{{ url_for("to_svg", graph_id=graph.id, name=graph.name) }}"
              method="post" id="export-svg" target="_blank" style="display:inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="svg"/>
            <button type="submit" class="btn btn-sm btn-default" title="{{ _("Export to SVG") }}">
                <span class="glyphicon glyphicon-share"></span> SVG
            </button>
        </form>
    </li>
    <li><label for="linkdistance">{{ _("Link length:") }}</label>
        <span id="linkdistance"></span>
    </li>
</ul>
</div> <!-- /graph-footer -->



{% endblock %}

{% block more_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="{{ url_for('static', filename='graph.js') }}"></script>
<script>
//<![CDATA[
    graph = setup_graph_page("{{ url_for('data', graph_id=graph.id) }}");
    setup_editor_page(graph);
//]]>
</script>
{% endblock %}
