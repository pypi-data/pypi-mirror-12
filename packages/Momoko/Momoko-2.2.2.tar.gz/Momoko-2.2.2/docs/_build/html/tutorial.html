<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; Momoko 2.2.2 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Momoko 2.2.2 documentation" href="index.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Momoko 2.2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will demonstrate all the functionality found in Momoko. It&#8217;s assumed a
working PostgreSQL database is available, and everything is done in the context of a
simple tornado web application. Not everything is explained: because Momoko just
wraps Psycopg2, the <a class="reference external" href="http://initd.org/psycopg/docs/cursor.html">Psycopg2 documentation</a> must be used alongside Momoko&#8217;s.</p>
<div class="section" id="the-principle">
<h2>The principle<a class="headerlink" href="#the-principle" title="Permalink to this headline">¶</a></h2>
<p>Almost every method of <a class="reference internal" href="api.html#momoko.Pool" title="momoko.Pool"><tt class="xref py py-meth docutils literal"><span class="pre">Pool()</span></tt></a> and <a class="reference internal" href="api.html#momoko.Connection" title="momoko.Connection"><tt class="xref py py-meth docutils literal"><span class="pre">Connection()</span></tt></a>
returns a <a class="reference external" href="http://tornado.readthedocs.org/en/latest/concurrent.html">future</a>. There are some notable exceptions, like
<a class="reference internal" href="api.html#momoko.Pool.close" title="momoko.Pool.close"><tt class="xref py py-meth docutils literal"><span class="pre">close()</span></tt></a>; be sure to consult API documentation for the
details.</p>
<p>These future objects can be simply <tt class="docutils literal"><span class="pre">yield</span></tt>-ed in Tornado methods decorated with <tt class="docutils literal"><span class="pre">gen.coroutine</span></tt>.
For SQL execution related methods these futures resolve to corresponding cursor objects.</p>
</div>
<div class="section" id="trival-example">
<h2>Trival example<a class="headerlink" href="#trival-example" title="Permalink to this headline">¶</a></h2>
<p>Here is the simplest synchronous version of connect/select code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dsn</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT 1&quot;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
<p>And this is how the same code looks with Momoko/Tornado:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">momoko</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<span class="n">ioloop</span> <span class="o">=</span> <span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">momoko</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">dsn</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">)</span>
<span class="n">future</span> <span class="o">=</span> <span class="n">ioloop</span><span class="o">.</span><span class="n">add_future</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">(),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ioloop</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
<span class="n">ioloop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c"># raises exception on connection error</span>

<span class="n">future</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT 1&quot;</span><span class="p">)</span>
<span class="n">ioloop</span><span class="o">.</span><span class="n">add_future</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ioloop</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
<span class="n">ioloop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
<p>We create connection object. Then invoke <tt class="docutils literal"><span class="pre">connect()</span></tt> method that returns future that
resolves to connection object itself when connection is ready (we already have connection
object at hand, thus we just wait until future is ready, ignoring its result).</p>
<p>Next we call <tt class="docutils literal"><span class="pre">execute()</span></tt> which returns future that resolves to ready-to-use cursor object.
And we use IOLoop again to wait for this future to be ready.</p>
<p>Now you know to use <a class="reference internal" href="api.html#momoko.Connection" title="momoko.Connection"><tt class="xref py py-meth docutils literal"><span class="pre">Connection()</span></tt></a> for working with with stand-alone
connections to PostgreSQL in asynchronous mode.</p>
</div>
<div class="section" id="introducing-pool">
<h2>Introducing Pool<a class="headerlink" href="#introducing-pool" title="Permalink to this headline">¶</a></h2>
<p>The real power of Momoko comes with <a class="reference internal" href="api.html#momoko.Pool" title="momoko.Pool"><tt class="xref py py-meth docutils literal"><span class="pre">Pool()</span></tt></a>. It provides several
nice features that make it useful in production environments:</p>
<dl class="docutils">
<dt>Connection pooling</dt>
<dd>It manages several connections and distributes queries requests between them.
If all connections are busy, outstanding query requests are waiting in queue</dd>
<dt>Automatic pool growing (stretching)</dt>
<dd>You can allow automatic stretching - i.e. if all connections are busy and more
requests are coming, Pool will open more connections up a certain limit</dd>
<dt>Automatic reconnects</dt>
<dd>If connections get terminated (database server restart, etc) Pool will automatically
reconnect them and transparently retry query if it failed due to dead connection.</dd>
</dl>
<div class="section" id="boilerplate">
<h3>Boilerplate<a class="headerlink" href="#boilerplate" title="Permalink to this headline">¶</a></h3>
<p>Here&#8217;s the code that&#8217;s needed for the rest of this tutorial. Each example will replace parts
or extend upon this code. The code is kept simple and minimal; its purpose is just
to demonstrate Momoko&#8217;s functionality. Here it goes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tornado</span> <span class="kn">import</span> <span class="n">gen</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<span class="kn">from</span> <span class="nn">tornado.httpserver</span> <span class="kn">import</span> <span class="n">HTTPServer</span>
<span class="kn">from</span> <span class="nn">tornado.options</span> <span class="kn">import</span> <span class="n">parse_command_line</span>
<span class="kn">from</span> <span class="nn">tornado</span> <span class="kn">import</span> <span class="n">web</span>

<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">import</span> <span class="nn">momoko</span>


<span class="k">class</span> <span class="nc">BaseHandler</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">db</span>


<span class="k">class</span> <span class="nc">TutorialHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Some text here!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parse_command_line</span><span class="p">()</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">([</span>
        <span class="p">(</span><span class="s">r&#39;/&#39;</span><span class="p">,</span> <span class="n">TutorialHandler</span><span class="p">)</span>
    <span class="p">],</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ioloop</span> <span class="o">=</span> <span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>

    <span class="n">application</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">momoko</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span>
        <span class="n">dsn</span><span class="o">=</span><span class="s">&#39;dbname=your_db user=your_user password=very_secret_password &#39;</span>
            <span class="s">&#39;host=localhost port=5432&#39;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">ioloop</span><span class="o">=</span><span class="n">ioloop</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c"># this is a one way to run ioloop in sync</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">ioloop</span><span class="o">.</span><span class="n">add_future</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">ioloop</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
    <span class="n">ioloop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c"># raises exception on connection error</span>

    <span class="n">http_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>
    <span class="n">http_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">,</span> <span class="s">&#39;localhost&#39;</span><span class="p">)</span>
    <span class="n">ioloop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>For more information about all the parameters passed to <tt class="docutils literal"><span class="pre">momoko.Pool</span></tt> see
<a class="reference internal" href="api.html#momoko.Pool" title="momoko.Pool"><tt class="xref py py-class docutils literal"><span class="pre">momoko.Pool</span></tt></a> in the API documentation.</p>
</div>
</div>
<div class="section" id="using-pool">
<h2>Using Pool<a class="headerlink" href="#using-pool" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="api.html#momoko.Pool.execute" title="momoko.Pool.execute"><tt class="xref py py-meth docutils literal"><span class="pre">execute()</span></tt></a>, <a class="reference internal" href="api.html#momoko.Pool.callproc" title="momoko.Pool.callproc"><tt class="xref py py-meth docutils literal"><span class="pre">callproc()</span></tt></a>, <a class="reference internal" href="api.html#momoko.Pool.transaction" title="momoko.Pool.transaction"><tt class="xref py py-meth docutils literal"><span class="pre">transaction()</span></tt></a>
and  <a class="reference internal" href="api.html#momoko.Pool.mogrify" title="momoko.Pool.mogrify"><tt class="xref py py-meth docutils literal"><span class="pre">mogrify()</span></tt></a> are methods of <a class="reference internal" href="api.html#momoko.Pool" title="momoko.Pool"><tt class="xref py py-class docutils literal"><span class="pre">momoko.Pool</span></tt></a> which
can be used to query the database. (Actually, <tt class="docutils literal"><span class="pre">mogrify()</span></tt> is only used to
escape strings, but it needs a connection). All these methods, except <tt class="docutils literal"><span class="pre">mogrify()</span></tt>,
return a cursor or an exception object. All of the described retrieval methods in
Psycopg2&#8217;s documentation — <a class="reference external" href="http://initd.org/psycopg/docs/cursor.html#cursor.fetchone">fetchone</a>, <a class="reference external" href="http://initd.org/psycopg/docs/cursor.html#cursor.fetchmany">fetchmany</a>, <a class="reference external" href="http://initd.org/psycopg/docs/cursor.html#cursor.fetchall">fetchall</a>, etc. — can be used
to fetch the results.</p>
<p>First, lets rewrite our trivial example using Tornado web handlers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TutorialHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="nd">@gen.coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT 1;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Results: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
<p>To execute several queries in parallel, accumulate corresponding futures and
yield them at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TutorialHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="nd">@gen.coroutine</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select 1;&#39;</span><span class="p">)</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select 2;&#39;</span><span class="p">)</span>
            <span class="n">f3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select 3;&#39;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="p">[</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">]</span>

            <span class="n">cursor1</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">cursor2</span> <span class="o">=</span> <span class="n">f2</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">cursor3</span> <span class="o">=</span> <span class="n">f3</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">Warning</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Q1: </span><span class="si">%r</span><span class="s">&lt;br&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cursor1</span><span class="o">.</span><span class="n">fetchall</span><span class="p">(),))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Q2: </span><span class="si">%r</span><span class="s">&lt;br&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cursor2</span><span class="o">.</span><span class="n">fetchall</span><span class="p">(),))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Q3: </span><span class="si">%r</span><span class="s">&lt;br&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cursor3</span><span class="o">.</span><span class="n">fetchall</span><span class="p">(),))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
<p>All the above examples use <a class="reference internal" href="api.html#momoko.Pool.execute" title="momoko.Pool.execute"><tt class="xref py py-meth docutils literal"><span class="pre">execute()</span></tt></a>, but work
with <a class="reference internal" href="api.html#momoko.Pool.callproc" title="momoko.Pool.callproc"><tt class="xref py py-meth docutils literal"><span class="pre">callproc()</span></tt></a>, <a class="reference internal" href="api.html#momoko.Pool.transaction" title="momoko.Pool.transaction"><tt class="xref py py-meth docutils literal"><span class="pre">transaction()</span></tt></a> and
<a class="reference internal" href="api.html#momoko.Pool.mogrify" title="momoko.Pool.mogrify"><tt class="xref py py-meth docutils literal"><span class="pre">mogrify()</span></tt></a> too.</p>
</div>
<div class="section" id="advanced">
<h2>Advanced<a class="headerlink" href="#advanced" title="Permalink to this headline">¶</a></h2>
<div class="section" id="manual-connection-management">
<h3>Manual connection management<a class="headerlink" href="#manual-connection-management" title="Permalink to this headline">¶</a></h3>
<p>You can manually acquire connection from the pool using the <a class="reference internal" href="api.html#momoko.Pool.getconn" title="momoko.Pool.getconn"><tt class="xref py py-meth docutils literal"><span class="pre">getconn()</span></tt></a> method.
This is very useful, for example, for server-side cursors.</p>
<p>It important to return connection back to the pool once you&#8217;ve done with it, even if an error occurs
in the middle of your work. Use either
<a class="reference internal" href="api.html#momoko.Pool.putconn" title="momoko.Pool.putconn"><tt class="xref py py-meth docutils literal"><span class="pre">putconn()</span></tt></a>
method or
<a class="reference internal" href="api.html#momoko.Pool.manage" title="momoko.Pool.manage"><tt class="xref py py-meth docutils literal"><span class="pre">manage()</span></tt></a>
manager to return the connection.</p>
<p>Here is the server-side cursor example (based on the code in momoko unittests):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@gen.coroutine</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">int_count</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">getconn</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">manage</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;BEGIN&quot;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;DECLARE all_ints CURSOR FOR SELECT * FROM unit_test_int_table&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">int_count</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;FETCH </span><span class="si">%s</span><span class="s"> FROM all_ints&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">chunk</span><span class="p">,))</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="c"># Do something with results...</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">chunk</span>
            <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;CLOSE all_ints&quot;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;COMMIT&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#the-principle">The principle</a></li>
<li><a class="reference internal" href="#trival-example">Trival example</a></li>
<li><a class="reference internal" href="#introducing-pool">Introducing Pool</a><ul>
<li><a class="reference internal" href="#boilerplate">Boilerplate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-pool">Using Pool</a></li>
<li><a class="reference internal" href="#advanced">Advanced</a><ul>
<li><a class="reference internal" href="#manual-connection-management">Manual connection management</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">API</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">Momoko 2.2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2015, Frank Smit &amp; Zaar Hai.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>