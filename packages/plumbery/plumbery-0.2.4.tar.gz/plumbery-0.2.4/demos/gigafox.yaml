---
# fittings to be deployed, managed, and destroyed in the cloud infrastructure of Dimension Data

# in safe mode no change is actually made on the infrastructure
safeMode: False

#
polishers:
  - ansible:
      reap: demo_gigafox_ansible.yaml
  - rub:
#      key: ~/.ssh/id_rsa.pub
      reap: demo_gigafox_rub.yaml
  - spit:
      reap: demo_gigafox_spit.yaml

# each facility is described separately
---
# Frankfurt in Europe - 10.2.x.y
locationId: EU6
regionId: dd-eu

basement: control

rub:
    - beachhead: 10.1.10.9

blueprints:

  # management, administration, and monitoring
  - control:
      domain: &vdc1
        name: GigaFox.EU
        description: '#eu'
        service: ADVANCED
      ethernet:
        name: gigafox.control
        subnet: 10.1.10.0
        description: '#eu'
      nodes:
        - stackstorm10:
            description: '#stackstorm #eu #ops'
            running: always
        - beachhead10:
            description: '#beachhead #eu #ops'
            running: always
        - apacheTest:
            description: 'Apache #web #eu'
#            cpu: 4
#            memory: 8
#            disks:
#              - 500 STANDARD
#              - 100 HIGHPERFORMANCE
            monitoring: essentials
            rub:
              - run rub.update.sh
              - put rub.puppet.apache.pp /root/apache.pp
              - run rub.puppet.sh /root/apache.pp

  # workloads dealing directly with end-user devices
  - web:
      domain: *vdc1
      ethernet:
        name: gigafox.web
        subnet: 10.1.1.0
        accept:
          - gigafox.control
        description: '#eu'
      nodes:
        - apache[10..11]:
            description: 'Apache #web #eu'
            rub:
              - run rub.update.sh
              - put rub.puppet.apache.pp
              - run rub.puppet.sh rub.puppet.apache.pp
      pool:
        address: public

  # workloads dealing with short-term memory
  - redis:
      domain: *vdc1
      ethernet: &data
        name: gigafox.data
        subnet: 10.1.2.0
        accept:
          - gigafox.control
        description: '#eu'
      nodes:
        - redis[10..12]:
            description: '#redis #eu'
            rub:
              - rub.update.sh

  # workloads dedicated to BLOBs
  - mongodb:
      domain: *vdc1
      ethernet: *data
      nodes:
        - mongo[10..16]:
            description: '#mongo #eu'
            rub:
              - rub.update.sh

---
# Virginia in US - 10.3.x.y
locationId: NA9
regionId: dd-na

blueprints:

  # workloads dealing directly with end-user devices
  - web:
      domain: &vdc2
        name: GigaFox.US
        description: '#us'
        service: ADVANCED
      ethernet:
        name: gigafox.web
        subnet: 10.2.1.0
        description: '#us'
        accept:
          - dd-eu::EU6::gigafox.control
      nodes:
        - apache[20..21]:
            description: 'Apache #web #us'
            monitoring: essentials
            rub:
              - rub.update.sh

  # workloads dealing with short-term memory
  - redis:
      domain: *vdc2
      ethernet:
        name: gigafox.redis
        subnet: 10.2.2.0
        description: '#us'
        accept:
          - gigafox.web
          - dd-eu::EU6::gigafox.control
      nodes:
        - redis[20..22]:
            description: '#redis #us'
            monitoring: essentials
            rub:
              - rub.update.sh

  # workloads dedicated to BLOBs
  - mongodb:
      domain: *vdc2
      ethernet:
        name: gigafox.mongodb
        subnet: 10.2.3.0
        description: '#us'
        accept:
          - gigafox.web
          - dd-eu::EU6::gigafox.control
      nodes:
        - mongo[20..26]:
            description: '#mongo #us'
            monitoring: essentials
            rub:
              - rub.update.sh

