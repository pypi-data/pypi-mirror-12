---
# fittings to be deployed, managed, and destroyed in the cloud infrastructure of Dimension Data

# in safe mode no change is actually made on the infrastructure
safeMode: False

#
polishers:
  - ansible:
      reap: test_inventory.yaml
  - rub:
      key: ~/.ssh/id_rsa.pub
      reap: test_rubs.yaml
  - spit:
      reap: test_nodes.yaml

# each facility is described separately
---
# Frankfurt in Europe - 10.1.x.y
locationId: EU6
regionId: dd-eu

rub:
  - beachhead: 10.1.10.9
  - beachhead: 10.1.10.10

blueprints:

  # management, administration, and monitoring
  - control:
      domain: &vdc1
        name: VDC1
        service: ADVANCED
        description: '#vdc1'
      ethernet:
        name: control
        subnet: 10.1.10.0
        description: '#vdc1'
      nodes:
        - stackstorm1:
            description: 'StackStorm engine #vdc1 #ops'
            address: 10.1.10.8
            running: always
        - beachhead1:
            description: 'Plumbery engine #vdc1 #ops'
            address: 10.1.10.9
            running: always

  # docker resources
  - docker:
      domain: *vdc1
      ethernet: &containers
        name: containers
        subnet: 10.1.2.0
        description: '#vdc1'
      nodes:
        - docker1:
            description: 'Docker #vdc1 #docker'
            rub: &docker
              - rub.update.sh
              - rub.docker.sh
        - docker2:
            description: 'Docker #vdc1 #docker'
            rub: *docker
        - docker3:
            description: 'Docker #vdc1 #docker'
            rub: *docker

  # secondary sql servers
  - sql:
      domain: *vdc1
      ethernet: &data
        name: data
        subnet: 10.1.3.0
        description: '#vdc1'
      nodes:
        - slaveSQL:
            description: 'SQL #vdc1 #secondary'
            appliance: 'RedHat 6 64-bit 4 CPU'

---
# Amsterdam in Europe - 10.2.x.y
locationId: EU7
regionId: dd-eu

blueprints:

  # management, administration, and monitoring
  - control:
      domain: &vdc2
        name: VDC2
        description: '#vdc2'
      ethernet:
        name: control
        subnet: 10.2.10.0
        description: '#vdc2'
      nodes:
        - stackstorm2:
            description: 'StackStorm engine #vdc2 #ops'
            appliance: 'RedHat 6 64-bit 4 CPU'
        - zabbix2:
            description: 'Zabbix dashboard #vdc2 #ops'
            appliance: 'RedHat 6 64-bit 2 CPU'
        - scom1:
            appliance: 'Win2012 R2 Std 4 CPU'
            description: 'Microsoft System Center Operation Manager #vdc2 #ops'
        - scom2:
            appliance: 'Win2012 R2 Std 4 CPU'
            description: 'Microsoft System Center Operation Manager #vdc2 #ops'

  # workloads dealing directly with end-user devices
  - web:
      domain: *vdc2
      ethernet: &prod
        name: production
        subnet: 10.2.2.0
        description: '#vdc2'
      nodes:
        - web1:
            description: 'Stateless web #vdc2 #primary'
        - web2:
            description: 'Stateless web #vdc2 #primary'
        - web3:
            description: 'Stateless web #vdc2 #primary'
        - web4:
            description: 'Stateless web #vdc2 #primary'
        - web5:
            description: 'Stateless web #vdc2 #primary'

  # workloads dealing with short-term memory
  - memcache:
      domain: *vdc2
      ethernet: *prod
      nodes:
        - redis1:
            description: 'Redis #vdc2 #primary'
        - redis2:
            description: 'Redis #vdc2 #primary'

  # workloads dedicated to data records
  - sql:
      domain: *vdc2
      ethernet: &data
        name: data
        subnet: 10.2.3.0
        description: '#vdc2'
      nodes:
        - masterSQL:
            description: 'SQL #vdc2 #primary'
            appliance: 'RedHat 6 64-bit 4 CPU'

  # workloads dedicated to big data
  - cassandra:
      domain: *vdc2
      ethernet: *data
      nodes:
        - cassandra1:
            description: 'Cassandra #vdc2 #primary'
        - cassandra2:
            description: 'Cassandra #vdc2 #primary'
        - cassandra3:
            description: 'Cassandra #vdc2 #primary'

  # workloads dedicated to BLOBs
  - mongodb:
      domain: *vdc2
      ethernet: *data
      nodes:
        - mongo1:
            description: 'MongoDB #vdc2 #primary'
        - mongo2:
            description: 'MongoDB #vdc2 #primary'
        - mongo3:
            description: 'MongoDB #vdc2 #primary'

  # workloads devoted to object-based storage
  - s3:
      domain: *vdc2
      ethernet: *data
      nodes:
        - ceph1:
            description: 'Ceph #vdc2 #primary'
        - ceph2:
            description: 'Ceph #vdc2 #primary'
        - ceph3:
            description: 'Ceph #vdc2 #primary'

  # workloads dedicated to source code and related
  - source:
      domain: *vdc2
      ethernet:
        name: source
        subnet: 10.0.4.0
        description: '#vdc2'
      nodes:
        - gitlab:
            description: 'GitLab #vdc2 #dev'

# some network domains may have been created manually - they are considered part of these fittings
domains:

# some nodes may have been created manually - they are considered part of these fittings
nodes:




