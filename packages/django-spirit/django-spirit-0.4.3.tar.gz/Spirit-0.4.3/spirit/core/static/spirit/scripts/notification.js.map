{"version":3,"sources":["notification.coffee"],"names":[],"mappings":"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","file":"notification.js","sourceRoot":"/source/","sourcesContent":["###\n  Notifications ajax tab\n  requires: util.js, tab.js\n###\n\n$ = jQuery\n\n\nclass Notification\n\n  defaults:\n    notificationUrl: \"#ajax\",\n    notificationListUrl: \"#show-all\",\n    mentionTxt: \"{user} mention you on {topic}\",\n    commentTxt: \"{user} has commented on {topic}\",\n    showAll: \"Show all\",\n    empty: \"Nothing to show\",\n    unread: \"unread\"\n\n  constructor: (el, options) ->\n    @el = $(el)\n    @options = $.extend {}, @defaults, options\n    @tabNotificationContent = $(@el.data \"related\")\n    do @setUp\n\n  setUp: ->\n    # on first click\n    @el.one 'click', @tabSwitch\n    @el.one 'click', @stopClick\n\n  tabSwitch: =>\n    get = $.getJSON @options.notificationUrl\n\n    get.done (data, status, jqXHR) =>\n      if data.n.length > 0\n        @addNotifications data\n      else\n        do @addIsEmptyTxt\n\n    get.fail (jqxhr, textStatus, error) =>\n      @addErrorTxt textStatus, error\n\n    get.always =>\n      do @ajaxDone\n\n    return\n\n  addNotifications: (data) =>\n    unread = \"<span class=\\\"row-unread\\\">#{ @options.unread }</span>\"\n\n    $.each data.n, (i, obj) =>\n      if obj.action is 1\n        txt = @options.mentionTxt\n      else\n        txt = @options.commentTxt\n\n      if not obj.is_read\n        txt = \"#{ txt } #{ unread }\"\n\n      link = \"<a href=\\\"#{ obj.url }\\\">#{ obj.title }</a>\"\n      txt = $.format txt, {user: obj.user, topic: link}\n      @tabNotificationContent.append \"<div>#{ txt }</div>\"\n\n    showAllLink = \"<a href=\\\"#{ @options.notificationListUrl }\\\">#{ @options.showAll }</a>\"\n    @tabNotificationContent.append \"<div>#{ showAllLink }</div>\"\n\n  addIsEmptyTxt: =>\n    @tabNotificationContent.append \"<div>#{ @options.empty }</div>\"\n\n  addErrorTxt: (textStatus, error) =>\n    @tabNotificationContent.append \"<div>Error: #{ textStatus }, #{ error }</div>\"\n\n  ajaxDone: =>\n    @el.addClass \"js-tab\"\n    do $.tab\n    @el.trigger 'click'\n\n  stopClick: (e) ->\n    do e.preventDefault\n    do e.stopPropagation\n    return\n\n\n$.extend\n  notification: (options) ->\n    $('.js-tab-notification').each ->\n      if not $(@).data 'plugin_notification'\n        $(@).data 'plugin_notification', new Notification(@, options)\n\n$.notification.Notification = Notification"]}