{"version":3,"sources":["bookmark.coffee"],"names":[],"mappings":";AAAA;;;;;AAAA;AAAA,MAAA,iBAAA;IAAA;;EAKA,CAAA,GAAI;;EAGE;IAES,cAAA;MACX,IAAC,CAAA,SAAD,GAAa;MACb,IAAC,CAAA,aAAD,GAAoB,IAAC,CAAA,iBAAJ,CAAA;IAFN;;mBAIb,iBAAA,GAAmB,SAAA;AACjB,UAAA;MAAA,aAAA,GAAgB,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAArB,CAA2B,IAA3B,CAAiC,CAAA,CAAA;MACjD,aAAA,GAAgB,QAAA,CAAS,aAAT,EAAwB,EAAxB;MAEhB,IAAG,KAAA,CAAM,aAAN,CAAH;QACE,aAAA,GAAgB,EADlB;OAAA,MAAA;AAAA;;MAIA,aAAA,IAAiB;AAEjB,aAAO;IAVU;;;;;;EAaf;uBAEJ,QAAA,GACE;MAAA,SAAA,EAAW,YAAX;MACA,MAAA,EAAQ,YADR;;;IAGW,kBAAC,EAAD,EAAK,IAAL,EAAW,OAAX;;;MACX,IAAC,CAAA,EAAD,GAAM,CAAA,CAAE,EAAF;MACN,IAAC,CAAA,IAAD,GAAQ;MACR,IAAC,CAAA,OAAD,GAAW,CAAC,CAAC,MAAF,CAAS,EAAT,EAAa,IAAC,CAAA,QAAd,EAAwB,OAAxB;MACR,IAAC,CAAA,KAAJ,CAAA;IAJW;;uBAMb,KAAA,GAAO,SAAA;aACL,IAAC,CAAA,EAAE,CAAC,QAAJ,CAAa,IAAC,CAAA,UAAd,EAA0B;QAAC,MAAA,EAAQ,MAAT;OAA1B;IADK;;uBAGP,UAAA,GAAY,SAAA;AACV,UAAA;MAAA,gBAAA,GAAmB,IAAC,CAAA,EAAE,CAAC,IAAJ,CAAS,QAAT;MAEnB,IAAG,gBAAA,GAAmB,IAAC,CAAA,IAAI,CAAC,aAA5B;QACE,IAAC,CAAA,IAAI,CAAC,aAAN,GAAsB;QACnB,IAAC,CAAA,iBAAJ,CAAA,EAFF;;IAHU;;uBASZ,iBAAA,GAAmB,SAAA;AACjB,UAAA;MAAA,IAAG,IAAC,CAAA,IAAI,CAAC,SAAT;AACE,eADF;;MAGA,IAAC,CAAA,IAAI,CAAC,SAAN,GAAkB;MAElB,IAAA,GAAO,CAAC,CAAC,IAAF,CAAO,IAAC,CAAA,OAAO,CAAC,MAAhB,EAAwB;QAAC,mBAAA,EAAqB,IAAC,CAAA,OAAO,CAAC,SAA/B;QAA0C,cAAA,EAAgB,IAAC,CAAA,IAAI,CAAC,aAAhE;OAAxB;aACP,IAAI,CAAC,MAAL,CAAY,CAAA,SAAA,KAAA;eAAA,SAAA;iBACV,KAAC,CAAA,IAAI,CAAC,SAAN,GAAkB;QADR;MAAA,CAAA,CAAA,CAAA,IAAA,CAAZ;IAPiB;;;;;;EAWrB,CAAC,CAAC,EAAE,CAAC,MAAL,CACE;IAAA,QAAA,EAAU,SAAC,OAAD;AACR,UAAA;MAAA,IAAA,GAAW,IAAA,IAAA,CAAA;aAEX,IAAC,CAAA,IAAD,CAAM,SAAA;QACJ,IAAG,CAAI,CAAA,CAAE,IAAF,CAAI,CAAC,IAAL,CAAU,iBAAV,CAAP;iBACE,CAAA,CAAE,IAAF,CAAI,CAAC,IAAL,CAAU,iBAAV,EAAiC,IAAA,QAAA,CAAS,IAAT,EAAY,IAAZ,EAAkB,OAAlB,CAAjC,EADF;;MADI,CAAN;IAHQ,CAAV;GADF;;EAQA,CAAC,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAd,GAAyB;;EACzB,CAAC,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAd,GAAqB;AAvErB","file":"bookmark.js","sourceRoot":"/source/","sourcesContent":["###\n  A library to tell the server how far you have scrolled down.\n  requires: waypoints\n###\n\n$ = jQuery\n\n\nclass Mark\n\n  constructor: ->\n    @isSending = false\n    @commentNumber = do @_getCommentNumber\n\n  _getCommentNumber: ->\n    commentNumber = window.location.hash.split(\"#c\")[1]\n    commentNumber = parseInt commentNumber, 10  # base 10\n\n    if isNaN commentNumber\n      commentNumber = 0\n    else\n      # workaround to always send comment number from hash\n\t\t  commentNumber -= 1\n\n    return commentNumber\n\n\nclass Bookmark\n\n  defaults:\n    csrfToken: \"csrf_token\"\n    target: \"target url\"\n\n  constructor: (el, mark, options) ->\n    @el = $(el)\n    @mark = mark\n    @options = $.extend {}, @defaults, options\n    do @setUp\n\n  setUp: ->\n    @el.waypoint @onWaypoint, {offset: '100%', }\n\n  onWaypoint: =>\n    newCommentNumber = @el.data 'number'\n\n    if newCommentNumber > @mark.commentNumber\n      @mark.commentNumber = newCommentNumber\n      do @sendCommentNumber\n\n    return\n\n  sendCommentNumber: =>\n    if @mark.isSending\n      return\n\n    @mark.isSending = true\n\n    post = $.post @options.target, {csrfmiddlewaretoken: @options.csrfToken, comment_number: @mark.commentNumber}\n    post.always =>\n      @mark.isSending = false\n\n\n$.fn.extend\n  bookmark: (options) ->\n    mark = new Mark()\n\n    @each ->\n      if not $(@).data 'plugin_bookmark'\n        $(@).data 'plugin_bookmark', new Bookmark(@, mark, options)\n\n$.fn.bookmark.Bookmark = Bookmark\n$.fn.bookmark.Mark = Mark"]}