{"version":3,"sources":["notification.coffee"],"names":[],"mappings":"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","file":"notification.js","sourceRoot":"/source/","sourcesContent":["###\n    Notifications ajax tab\n    requires: util.js, tab.js\n###\n\n$ = jQuery\n\n\nclass Notification\n\n    defaults: {\n        notificationUrl: \"#ajax\",\n        notificationListUrl: \"#show-all\",\n        mentionTxt: \"{user} mention you on {topic}\",\n        commentTxt: \"{user} has commented on {topic}\",\n        showAll: \"Show all\",\n        empty: \"Nothing to show\",\n        unread: \"unread\"\n    }\n\n    constructor: (el, options) ->\n        @el = $(el)\n        @options = $.extend({}, @defaults, options)\n        @tabNotificationContent = $(@el.data(\"related\"))\n        @setUp()\n\n    setUp: ->\n# on first click\n        @el.one('click', @tabSwitch)\n        @el.one('click', @stopClick)\n\n    tabSwitch: =>\n        get = $.getJSON(@options.notificationUrl)\n\n        get.done((data, status, jqXHR) =>\n            if data.n.length > 0\n                @addNotifications(data)\n            else\n                @addIsEmptyTxt()\n        )\n\n        get.fail((jqxhr, textStatus, error) =>\n            @addErrorTxt(textStatus, error)\n        )\n\n        get.always( =>\n            @ajaxDone()\n        )\n\n        return\n\n    addNotifications: (data) =>\n        unread = \"<span class=\\\"row-unread\\\">#{@options.unread}</span>\"\n\n        $.each(data.n, (i, obj) =>\n            if obj.action is 1\n                txt = @options.mentionTxt\n            else\n                txt = @options.commentTxt\n\n            if not obj.is_read\n                txt = \"#{txt} #{unread}\"\n\n            link = \"<a href=\\\"#{obj.url}\\\">#{obj.title}</a>\"\n            txt = $.format(txt, {user: obj.user, topic: link})\n            @tabNotificationContent.append(\"<div>#{txt}</div>\")\n        )\n\n        showAllLink = \"<a href=\\\"#{@options.notificationListUrl}\\\">#{@options.showAll}</a>\"\n        @tabNotificationContent.append(\"<div>#{showAllLink}</div>\")\n\n    addIsEmptyTxt: =>\n        @tabNotificationContent.append(\"<div>#{@options.empty}</div>\")\n\n    addErrorTxt: (textStatus, error) =>\n        @tabNotificationContent.append(\"<div>Error: #{textStatus}, #{error}</div>\")\n\n    ajaxDone: =>\n        @el.addClass(\"js-tab\")\n        $.tab()\n        @el.trigger('click')\n\n    stopClick: (e) ->\n        e.preventDefault()\n        e.stopPropagation()\n        return\n\n\n$.extend\n    notification: (options) ->\n        $('.js-tab-notification').each( ->\n            if not $(@).data('plugin_notification')\n                $(@).data('plugin_notification', new Notification(@, options))\n        )\n\n$.notification.Notification = Notification\n"]}