{"version":3,"sources":["bookmark.coffee"],"names":[],"mappings":";AAAA;;;;;AAAA;AAAA,MAAA,iBAAA;IAAA;;EAKA,CAAA,GAAI;;EAGE;IAEW,cAAA;MACT,IAAC,CAAA,SAAD,GAAa;MACb,IAAC,CAAA,aAAD,GAAiB,IAAC,CAAA,iBAAD,CAAA;IAFR;;mBAIb,iBAAA,GAAmB,SAAA;AACf,UAAA;MAAA,aAAA,GAAgB,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAArB,CAA2B,IAA3B,CAAiC,CAAA,CAAA;MACjD,aAAA,GAAgB,QAAA,CAAS,aAAT,EAAwB,EAAxB;MAEhB,IAAG,KAAA,CAAM,aAAN,CAAH;QACI,aAAA,GAAgB,EADpB;OAAA,MAAA;QAII,aAAA,IAAiB,EAJrB;;AAMA,aAAO;IAVQ;;;;;;EAajB;uBAEF,QAAA,GAAU;MACN,SAAA,EAAW,YADL;MAEN,MAAA,EAAQ,YAFF;;;IAKG,kBAAC,EAAD,EAAK,IAAL,EAAW,OAAX;;;MACT,IAAC,CAAA,EAAD,GAAM,CAAA,CAAE,EAAF;MACN,IAAC,CAAA,IAAD,GAAQ;MACR,IAAC,CAAA,OAAD,GAAW,CAAC,CAAC,MAAF,CAAS,EAAT,EAAa,IAAC,CAAA,QAAd,EAAwB,OAAxB;MACX,IAAC,CAAA,KAAD,CAAA;IAJS;;uBAMb,KAAA,GAAO,SAAA;aACH,IAAC,CAAA,EAAE,CAAC,QAAJ,CAAa,IAAC,CAAA,UAAd,EAA0B;QAAC,MAAA,EAAQ,MAAT;OAA1B;IADG;;uBAGP,UAAA,GAAY,SAAA;AACR,UAAA;MAAA,gBAAA,GAAmB,IAAC,CAAA,EAAE,CAAC,IAAJ,CAAS,QAAT;MAEnB,IAAG,gBAAA,GAAmB,IAAC,CAAA,IAAI,CAAC,aAA5B;QACI,IAAC,CAAA,IAAI,CAAC,aAAN,GAAsB;QACtB,IAAC,CAAA,iBAAD,CAAA,EAFJ;;IAHQ;;uBASZ,iBAAA,GAAmB,SAAA;AACf,UAAA;MAAA,IAAG,IAAC,CAAA,IAAI,CAAC,SAAT;AACI,eADJ;;MAGA,IAAC,CAAA,IAAI,CAAC,SAAN,GAAkB;MAClB,iBAAA,GAAoB,IAAC,CAAA,IAAI,CAAC;MAE1B,IAAA,GAAO,CAAC,CAAC,IAAF,CACH,IAAC,CAAA,OAAO,CAAC,MADN,EAEH;QACI,mBAAA,EAAqB,IAAC,CAAA,OAAO,CAAC,SADlC;QAEI,cAAA,EAAgB,IAAC,CAAA,IAAI,CAAC,aAF1B;OAFG;aAQP,IAAI,CAAC,MAAL,CAAa,CAAA,SAAA,KAAA;eAAA,SAAA;UACT,KAAC,CAAA,IAAI,CAAC,SAAN,GAAkB;UAElB,IAAG,KAAC,CAAA,IAAI,CAAC,aAAN,GAAsB,iBAAzB;mBACI,KAAC,CAAA,iBAAD,CAAA,EADJ;;QAHS;MAAA,CAAA,CAAA,CAAA,IAAA,CAAb;IAfe;;;;;;EAuBvB,CAAC,CAAC,EAAE,CAAC,MAAL,CACI;IAAA,QAAA,EAAU,SAAC,OAAD;AACN,UAAA;MAAA,IAAA,GAAW,IAAA,IAAA,CAAA;aAEX,IAAC,CAAA,IAAD,CAAO,SAAA;QACH,IAAG,CAAI,CAAA,CAAE,IAAF,CAAI,CAAC,IAAL,CAAU,iBAAV,CAAP;iBACI,CAAA,CAAE,IAAF,CAAI,CAAC,IAAL,CAAU,iBAAV,EAAiC,IAAA,QAAA,CAAS,IAAT,EAAY,IAAZ,EAAkB,OAAlB,CAAjC,EADJ;;MADG,CAAP;IAHM,CAAV;GADJ;;EASA,CAAC,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAd,GAAyB;;EACzB,CAAC,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAd,GAAqB;AArFrB","file":"bookmark.js","sourceRoot":"/source/","sourcesContent":["###\n    A library to tell the server how far you have scrolled down.\n    requires: waypoints\n###\n\n$ = jQuery\n\n\nclass Mark\n\n    constructor: ->\n        @isSending = false\n        @commentNumber = @_getCommentNumber()\n\n    _getCommentNumber: ->\n        commentNumber = window.location.hash.split(\"#c\")[1]\n        commentNumber = parseInt(commentNumber, 10)  # base 10\n\n        if isNaN(commentNumber)\n            commentNumber = 0\n        else\n            # workaround to always send comment number from hash\n            commentNumber -= 1\n\n        return commentNumber\n\n\nclass Bookmark\n\n    defaults: {\n        csrfToken: \"csrf_token\",\n        target: \"target url\"\n    }\n\n    constructor: (el, mark, options) ->\n        @el = $(el)\n        @mark = mark\n        @options = $.extend({}, @defaults, options)\n        @setUp()\n\n    setUp: ->\n        @el.waypoint(@onWaypoint, {offset: '100%'})\n\n    onWaypoint: =>\n        newCommentNumber = @el.data('number')\n\n        if newCommentNumber > @mark.commentNumber\n            @mark.commentNumber = newCommentNumber\n            @sendCommentNumber()\n\n        return\n\n    sendCommentNumber: =>\n        if @mark.isSending\n            return\n\n        @mark.isSending = true\n        sentCommentNumber = @mark.commentNumber\n\n        post = $.post(\n            @options.target,\n            {\n                csrfmiddlewaretoken: @options.csrfToken,\n                comment_number: @mark.commentNumber\n            }\n        )\n\n        post.always( =>\n            @mark.isSending = false\n\n            if @mark.commentNumber > sentCommentNumber\n                @sendCommentNumber()\n        )\n\n\n$.fn.extend\n    bookmark: (options) ->\n        mark = new Mark()\n\n        @each( ->\n            if not $(@).data('plugin_bookmark')\n                $(@).data('plugin_bookmark', new Bookmark(@, mark, options))\n        )\n\n$.fn.bookmark.Bookmark = Bookmark\n$.fn.bookmark.Mark = Mark\n"]}