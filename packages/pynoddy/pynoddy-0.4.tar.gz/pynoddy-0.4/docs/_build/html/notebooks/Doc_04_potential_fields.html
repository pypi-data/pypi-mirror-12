<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Read and Visualise Geophysical Potential-Fields &mdash; pynoddy  documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pynoddy  documentation" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="read-and-visualise-geophysical-potential-fields">
<h1>Read and Visualise Geophysical Potential-Fields<a class="headerlink" href="#read-and-visualise-geophysical-potential-fields" title="Permalink to this headline">¶</a></h1>
<p>Geophysical potential fields (gravity and magnetics) can be calculated
directly from the generated kinematic model. A wide range of options
also exists to consider effects of geological events on the relevant
rock properties. We will here use pynoddy to simply and quickly test the
effect of changing geological structures on the calculated geophysical
response.</p>
<div class="code python highlight-python"><div class="highlight"><pre>%matplotlib inline
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="c"># adjust some settings for matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c"># print rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="c"># determine path of repository to set paths corretly below</span>
<span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s">&#39;../..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pynoddy</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">css_file</span> <span class="o">=</span> <span class="s">&#39;pynoddy.css&#39;</span>
<span class="n">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">css_file</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<style>

@font-face {
    font-family: "Computer Modern";
    src: url('http://mirrors.ctan.org/fonts/cm-unicode/fonts/otf/cmunss.otf');
}

#notebook_panel { /* main background */
    background: #888;
    color: #f6f6f6;
}

div.cell { /* set cell width to about 80 chars */
    width: 800px;
}

div #notebook { /* centre the content */
    background: #fff; /* white background for content */
    width: 1000px;
    margin: auto;
    padding-left: 1em;
}

#notebook li { /* More space between bullet points */
margin-top:0.8em;
}

/* draw border around running cells */
div.cell.border-box-sizing.code_cell.running {
    border: 3px solid #111;
}

/* Put a solid color box around each cell and its output, visually linking them together */
div.cell.code_cell {
    background: #ddd;  /* rgba(230,230,230,1.0);  */
    border-radius: 10px; /* rounded borders */
    width: 900px;
    padding: 1em;
    margin-top: 1em;
}

div.text_cell_render{
    font-family: 'Arvo' sans-serif;
    line-height: 130%;
    font-size: 115%;
    width:700px;
    margin-left:auto;
    margin-right:auto;
}


/* Formatting for header cells */
.text_cell_render h1 {
    font-family: 'Alegreya Sans', sans-serif;
    /* font-family: 'Tangerine', serif; */
    /* font-family: 'Libre Baskerville', serif; */
    /* font-family: 'Karla', sans-serif;
    /* font-family: 'Lora', serif; */
    font-size: 50px;
    text-align: center;
    /* font-style: italic; */
    font-weight: 400;
    /* font-size: 40pt; */
    /* text-shadow: 4px 4px 4px #aaa; */
    line-height: 120%;
    color: rgb(12,85,97);
    margin-bottom: .5em;
    margin-top: 0.1em;
    display: block;
}
.text_cell_render h2 {
    /* font-family: 'Arial', serif; */
    /* font-family: 'Lora', serif; */
    font-family: 'Alegreya Sans', sans-serif;
    font-weight: 700;
    font-size: 24pt;
    line-height: 100%;
    /* color: rgb(171,165,131); */
    color: rgb(12,85,97);
    margin-bottom: 0.1em;
    margin-top: 0.1em;
    display: block;
}

.text_cell_render h3 {
    font-family: 'Arial', serif;
    margin-top:12px;
    margin-bottom: 3px;
    font-style: italic;
    color: rgb(95,92,72);
}

.text_cell_render h4 {
    font-family: 'Arial', serif;
}

.text_cell_render h5 {
    font-family: 'Alegreya Sans', sans-serif;
    font-weight: 300;
    font-size: 16pt;
    color: grey;
    font-style: italic;
    margin-bottom: .1em;
    margin-top: 0.1em;
    display: block;
}

.text_cell_render h6 {
    font-family: 'PT Mono', sans-serif;
    font-weight: 300;
    font-size: 10pt;
    color: grey;
    margin-bottom: 1px;
    margin-top: 1px;
}

.CodeMirror{
        font-family: "PT Mono";
        font-size: 100%;
}

</style><div class="section" id="read-history-file-from-virtual-explorer">
<h2>Read history file from Virtual Explorer<a class="headerlink" href="#read-history-file-from-virtual-explorer" title="Permalink to this headline">¶</a></h2>
<p>Many Noddy models are available on the site of the Virtual Explorer in
the Structural Geophysics Atlas. We will download and use one of these
models here as the base model.</p>
<p>We start with the history file of a &#8220;Fold and Thrust Belt&#8221; setting
stored on:</p>
<p><code class="docutils literal"><span class="pre">http://virtualexplorer.com.au/special/noddyatlas/ch3/ch3_5/his/nfold_thrust.his</span></code></p>
<p>The file can directly be downloaded and opened with pynoddy:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pynoddy.history</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>

<span class="n">his</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">url</span> <span class="o">=</span> \
            <span class="s">&quot;http://tectonique.net/asg/ch3/ch3_5/his/fold_thrust.his&quot;</span><span class="p">)</span>

<span class="n">his</span><span class="o">.</span><span class="n">determine_model_stratigraphy</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">his</span><span class="o">.</span><span class="n">change_cube_size</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Save to (local) file to compute and visualise model</span>
<span class="n">history_name</span> <span class="o">=</span> <span class="s">&quot;fold_thrust.his&quot;</span>
<span class="n">his</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">history_name</span><span class="p">)</span>
<span class="c"># his = pynoddy.history.NoddyHistory(history_name)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">output</span> <span class="o">=</span> <span class="s">&quot;fold_thrust_out&quot;</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">history_name</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;Running noddy exectuable at /Users/flow/git/pynoddy/pynoddy/noddy/noddy(.exe)</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pynoddy.output</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="c"># load and visualise model</span>
<span class="n">h_out</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># his.determine_model_stratigraphy()</span>
<span class="n">h_out</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span>
                   <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">his</span><span class="o">.</span><span class="n">model_stratigraphy</span><span class="p">,</span>
                   <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span>
                   <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                   <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
<span class="c">#                   savefig=True, fig_filename = &#39;fold_thrust_NS_section.eps&#39;,</span>
                   <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;YlOrRd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id1">
<img alt="png" src="../_images/Doc_04_potential_fields_11_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">h_out</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">his</span><span class="o">.</span><span class="n">model_stratigraphy</span><span class="p">,</span>
                   <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;YlOrRd&#39;</span><span class="p">,</span>
<span class="c">#                   savefig=True, fig_filename = &#39;fold_thrust_EW_section.eps&#39;,</span>
                   <span class="n">ve</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id2">
<img alt="png" src="../_images/Doc_04_potential_fields_12_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">h_out</span><span class="o">.</span><span class="n">export_to_vtk</span><span class="p">(</span><span class="n">vtk_filename</span> <span class="o">=</span> <span class="s">&quot;fold_thrust&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visualise-calculated-geophysical-fields">
<h2>Visualise calculated geophysical fields<a class="headerlink" href="#visualise-calculated-geophysical-fields" title="Permalink to this headline">¶</a></h2>
<p>The first step is to recompute the model with the generation of the
geophysical responses</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">history_name</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">sim_type</span> <span class="o">=</span> <span class="s">&#39;GEOPHYSICS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;Running noddy exectuable at /Users/flow/git/pynoddy/pynoddy/noddy/noddy(.exe)</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>We now get two files for the caluclated fields: &#8216;.grv&#8217; for gravity, and
&#8216;.mag&#8217; for the magnetic field. We can extract the information of these
files for visualisation and further processing in python:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="n">geophys</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyGeophysics</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="c"># imshow(geophys.grv_data, cmap = &#39;jet&#39;)</span>
<span class="c"># define contour levels</span>
<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">322</span><span class="p">,</span><span class="mi">344</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geophys</span><span class="o">.</span><span class="n">grv_data</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">324</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">342</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="c"># print levels</span>
</pre></div>
</div>
<div class="figure" id="id3">
<img alt="png" src="../_images/Doc_04_potential_fields_18_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
</div>
<div class="section" id="change-history-and-compare-gravity">
<h2>Change history and compare gravity<a class="headerlink" href="#change-history-and-compare-gravity" title="Permalink to this headline">¶</a></h2>
<p>As a next step, we will now change aspects of the geological history
(paramtereised in as parameters of the kinematic events) and calculate
the effect on the gravity. Then, we will compare the changed gravity
field to the original field.</p>
<p>Let&#8217;s have a look at the properties of the defined faults in the
original model:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Event </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&quot;Event type:</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">event_type</span>
    <span class="k">print</span> <span class="s">&quot;Fault slip:</span><span class="se">\t</span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Slip&#39;</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;Fault dip:</span><span class="se">\t</span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;Dip direction:</span><span class="se">\t</span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip Direction&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Event 2
Event type: FAULT
Fault slip: -5000.0
Fault dip:  0.0
Dip direction:  90.0

Event 3
Event type: FAULT
Fault slip: -3000.0
Fault dip:  0.0
Dip direction:  90.0

Event 4
Event type: FAULT
Fault slip: -3000.0
Fault dip:  0.0
Dip direction:  90.0

Event 5
Event type: FAULT
Fault slip: 12000.0
Fault dip:  80.0
Dip direction:  170.0
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
<span class="n">his2</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="s">&quot;fold_thrust.his&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="n">his2</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">130.0</span><span class="p">,</span> <span class="s">&#39;Cylindricity&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;Wavelength&#39;</span><span class="p">:</span> <span class="mf">12000.0</span><span class="p">,</span> <span class="s">&#39;Amplitude&#39;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="s">&#39;Pitch&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;Y&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;X&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;Single Fold&#39;</span><span class="p">:</span> <span class="s">&#39;FALSE&#39;</span><span class="p">,</span> <span class="s">&#39;Z&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">:</span> <span class="s">&#39;Fourier&#39;</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">110.0</span><span class="p">}</span>
</pre></div>
</div>
<p>As a simple test, we are changing the fault slip for all the faults and
simply add 1000 m to all defined slips. In order to not mess up the
original model, we are creating a copy of the history object first:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">copy</span>
<span class="n">his</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history_name</span><span class="p">)</span>
<span class="n">his</span><span class="o">.</span><span class="n">all_events_end</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">his_changed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">his</span><span class="p">)</span>

<span class="c"># change parameters of kinematic events</span>
<span class="n">slip_change</span> <span class="o">=</span> <span class="mf">2000.</span>
<span class="n">wavelength_change</span> <span class="o">=</span> <span class="mf">2000.</span>
<span class="c"># his_changed.events[3].properties[&#39;Slip&#39;] += slip_change</span>
<span class="c"># his_changed.events[5].properties[&#39;Slip&#39;] += slip_change</span>
<span class="c"># change fold wavelength</span>
<span class="n">his_changed</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Wavelength&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">wavelength_change</span>
<span class="n">his_changed</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">wavelength_change</span><span class="o">/</span><span class="mf">2.</span>
</pre></div>
</div>
<p>We now write the adjusted history back to a new history file and then
calculate the updated gravity field:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">his_changed</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed.his&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># %%timeit</span>
<span class="c"># recompute block model</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed.his&#39;</span><span class="p">,</span> <span class="s">&#39;fold_thrust_changed_out&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;Running noddy exectuable at /Users/flow/git/pynoddy/pynoddy/noddy/noddy(.exe)</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># %%timeit</span>
<span class="c"># recompute geophysical response</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed.his&#39;</span><span class="p">,</span> <span class="s">&#39;fold_thrust_changed_out&#39;</span><span class="p">,</span>
                      <span class="n">sim_type</span> <span class="o">=</span> <span class="s">&#39;GEOPHYSICS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;Running noddy exectuable at /Users/flow/git/pynoddy/pynoddy/noddy/noddy(.exe)</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># load changed block model</span>
<span class="n">geo_changed</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed_out&#39;</span><span class="p">)</span>
<span class="c"># load output and visualise geophysical field</span>
<span class="n">geophys_changed</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyGeophysics</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed_out&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="c"># imshow(geophys_changed.grv_data, cmap = &#39;jet&#39;)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geophys_changed</span><span class="o">.</span><span class="n">grv_data</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">324</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">342</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id4">
<img alt="png" src="../_images/Doc_04_potential_fields_30_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="c"># imshow(geophys.grv_data - geophys_changed.grv_data, cmap = &#39;jet&#39;)</span>
<span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">geophys</span><span class="o">.</span><span class="n">grv_data</span> <span class="o">-</span> <span class="n">geophys_changed</span><span class="o">.</span><span class="n">grv_data</span><span class="p">)))</span>
<span class="c"># comp_levels = np.arange(-maxval,1.01 * maxval, 0.05 * maxval)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geophys</span><span class="o">.</span><span class="n">grv_data</span> <span class="o">-</span> <span class="n">geophys_changed</span><span class="o">.</span><span class="n">grv_data</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;spectral&#39;</span><span class="p">)</span> <span class="c">#, comp_levels, cmap = &#39;RdBu_r&#39;)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="png" src="../_images/Doc_04_potential_fields_31_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># compare sections through model</span>
<span class="n">geo_changed</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">h_out</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id6">
<img alt="png" src="../_images/Doc_04_potential_fields_32_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="figure" id="id7">
<img alt="png" src="../_images/Doc_04_potential_fields_32_1.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Event </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Slip&#39;</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip&#39;</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">his</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;Dip Direction&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Event 2
-5000.0
0.0
90.0
Event 3
-3000.0
0.0
90.0
Event 4
-3000.0
0.0
90.0
Event 5
12000.0
80.0
170.0
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># recompute the geology blocks for comparison:</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed.his&#39;</span><span class="p">,</span> <span class="s">&#39;fold_thrust_changed_out&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;Running noddy exectuable at /Users/flow/git/pynoddy/pynoddy/noddy/noddy(.exe)</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">geology_changed</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="s">&#39;fold_thrust_changed_out&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">geology_changed</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span>
<span class="c">#                    layer_labels = his.model_stratigraphy,</span>
                   <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span>
                   <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                   <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
<span class="c">#                   savefig=True, fig_filename = &#39;fold_thrust_NS_section.eps&#39;,</span>
                   <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;YlOrRd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id8">
<img alt="png" src="../_images/Doc_04_potential_fields_36_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">geology_changed</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span>
                             <span class="c"># layer_labels = his.model_stratigraphy,</span>
                   <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;YlOrRd&#39;</span><span class="p">,</span>
<span class="c">#                   savefig=True, fig_filename = &#39;fold_thrust_EW_section.eps&#39;,</span>
                   <span class="n">ve</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id9">
<img alt="png" src="../_images/Doc_04_potential_fields_37_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Calculate block difference and export as VTK for 3-D visualisation:</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">diff_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">geology_changed</span><span class="p">)</span>
<span class="n">diff_model</span><span class="o">.</span><span class="n">block</span> <span class="o">-=</span> <span class="n">h_out</span><span class="o">.</span><span class="n">block</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">diff_model</span><span class="o">.</span><span class="n">export_to_vtk</span><span class="p">(</span><span class="n">vtk_filename</span> <span class="o">=</span> <span class="s">&quot;diff_model_fold_thrust_belt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="figure-with-all-results">
<h2>Figure with all results<a class="headerlink" href="#figure-with-all-results" title="Permalink to this headline">¶</a></h2>
<p>We now create a figure with the gravity field of the original and the
changed model, as well as a difference plot to highlight areas with
significant changes. This example also shows how additional equations
can easily be combined with pynoddy classes.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="c"># original plot</span>
<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">322</span><span class="p">,</span><span class="mi">344</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cf1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geophys</span><span class="o">.</span><span class="n">grv_data</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">324</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">342</span><span class="p">)</span>
<span class="c"># cbar1 = ax1.colorbar(cf1, orientation = &#39;horizontal&#39;)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Gravity of original model&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>




<span class="n">cf2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geophys_changed</span><span class="o">.</span><span class="n">grv_data</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">324</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">342</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Gravity of changed model&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>

<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>


<span class="n">comp_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.1</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">cf3</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">geophys</span><span class="o">.</span><span class="n">grv_data</span> <span class="o">-</span> <span class="n">geophys_changed</span><span class="o">.</span><span class="n">grv_data</span><span class="p">,</span> <span class="n">comp_levels</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">&#39;RdBu_r&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Gravity difference&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&quot;grav_ori_changed_compared.eps&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure" id="id10">
<img alt="png" src="../_images/Doc_04_potential_fields_41_0.png" />
<p class="caption"><span class="caption-text">png</span></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Read and Visualise Geophysical Potential-Fields</a><ul>
<li><a class="reference internal" href="#read-history-file-from-virtual-explorer">Read history file from Virtual Explorer</a></li>
<li><a class="reference internal" href="#visualise-calculated-geophysical-fields">Visualise calculated geophysical fields</a></li>
<li><a class="reference internal" href="#change-history-and-compare-gravity">Change history and compare gravity</a></li>
<li><a class="reference internal" href="#figure-with-all-results">Figure with all results</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/notebooks/Doc_04_potential_fields.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Florian Wellmann, Sam Thiele.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>